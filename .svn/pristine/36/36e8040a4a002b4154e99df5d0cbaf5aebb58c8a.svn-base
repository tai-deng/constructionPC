<!-- artifactsAssociatedä»»åŠ¡å…³è” -->
<template>
  <div class="container-artifacts-associated">
    <el-row>
      <el-col :span="12">
        <div>
          <el-button @click="tabList(false)" :class="{selected:!selected}">æ¸…å•å…³è”</el-button>
          <el-button @click="tabList(true)" :class="{selected:selected}">ä»»åŠ¡å…³è”</el-button>
          <el-button type="warning" @click="getCheckedKeys" style="float:right">ç¡®è®¤å…³è”</el-button>
        </div>
        <el-row :gutter="20">
          <el-col :span="10" v-loading="loading">
            <header>æ„ä»¶æ¸…å•</header>
            <el-select v-model="floorId" placeholder="è¯·é€‰æ‹©" id="select1" @change="GetElementTree">
              <el-option v-for="item in options" :key="item.id" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <el-tree ref="tree" node-key="id" class="tree_height" show-checkbox :default-expanded-keys="expandedKeys" :default-checked-keys="checkedKeys" highlight-current :data="array" :props="defaultProps" @check-change="handleCheckChange"></el-tree>
          </el-col>
          <el-col :span="14" v-show="!selected" v-loading="loading">
            <div v-if="listType===2">
              <el-col :span="12" :gutter="0" style="padding: 0">
                <el-select v-model="floorByModel" placeholder="è¯·é€‰æ‹©" @change="GetProjectName">
                  <el-option v-for="(item, idx) in floorByModelList" :key="idx" :label="item.text" :value="item.id"></el-option>
                </el-select>
              </el-col>
              <el-col :span="12" :gutter="0" style="padding: 0">
                <el-select v-model="pro" placeholder="è¯·é€‰æ‹©" @change="GetAllCostList">
                  <el-option v-for="(item, idx) in projectList" :key="idx" :label="item.text" :value="item.id"></el-option>
                </el-select>
              </el-col>
            </div>
            <!-- æ–½å·¥å›¾æ¸…å• -->
            <el-col :span="24" v-if="listType === 1" style="padding: 0">
              <el-select v-model="value2" placeholder="è¯·é€‰æ‹©" @change="GetBOQList">
                <el-option v-for="(item, idx) in options2" :key="idx" :label="item.ImportType" :value="item.ImportType"></el-option>
              </el-select>
            </el-col>
            <el-editable v-if="listType === 1" ref="editable" height="590" :edit-config="{trigger: 'manual', mode: 'row'}" :edit-rules="validRules" :data.sync="list" @row-click="rowClickEvent">
              <el-editable-column label width="45" v-if="list.length">
                <template slot-scope="scope">
                  <i class="cursor" :class="treeIcons(scope.row)" @click="toggleCollapseNode(scope.row)"></i>
                  <el-checkbox v-show="scope.row.parentId" v-model="scope.row.isCheck" :indeterminate="scope.row.indeterminate" @change="treeNodeChange(scope.row)"></el-checkbox>
                </template>
              </el-editable-column>
              <el-editable-column v-for="(item, idx) in columnList" :key="idx" :prop="item" :label="item" :edit-render="{name: item === 'æ„ä»¶åç§°' ? 'ElInput' : 'ElInputNumber'}">
              </el-editable-column>
              <el-editable-column width="50" fixed="right" v-if="list.length">
                <template slot-scope="scope">
                  <!-- hasActiveRow åˆ¤æ–­å½“å‰æ˜¯å¦æ´»åŠ¨è¡Œ -->
                  <template v-if="$refs.editable.hasActiveRow(scope.row)">
                    <i class="el-icon-check cursor" @click="saveRowEvent(scope.row,'editable')"></i>
                    <i class="el-icon-close cursor" @click="cancelRowEvent(scope.row,'editable')"></i>
                  </template>
                  <!-- æ–°å¢ä¸€è¡Œ -->
                  <template v-else>
                    <i class="el-icon-plus cursor" v-show="!scope.row.parentId" @click="insertEvent(scope.row,'editable')"></i>
                  </template>
                </template>
              </el-editable-column>
            </el-editable>
            <!-- å…¨è´¹ç”¨æ¸…å• -->
            <el-editable v-if="listType === 2" ref="editable2" height="590" :edit-config="{trigger: 'dblclick'}" :edit-rules="validRules2" :data.sync="list" @clear-active="clearActiveEvent" @selection-change="handleSelectionChange">
              <el-editable-column label width="45">
                <template slot-scope="scope">
                  <i :class="treeIcons(scope.row)" @click="toggleCollapseNode(scope.row)"></i>
                  <el-checkbox v-model="scope.row.isCheck" :indeterminate="scope.row.indeterminate" :disabled="scope.row.isDisabled" @change="treeNodeChange(scope.row)"></el-checkbox>
                </template>
              </el-editable-column>
              <el-editable-column prop="ProjectCode" label="é¡¹ç›®ç¼–ç "></el-editable-column>
              <el-editable-column prop="ProjectName" label="é¡¹ç›®åç§°"></el-editable-column>
              <el-editable-column prop="Quantities" label="å·¥ç¨‹é‡" :edit-render="{name: 'ElInputNumber'}"></el-editable-column>
              <el-editable-column width="50">
                <template slot-scope="scope">
                  <template v-if="$refs.editable2.hasActiveRow(scope.row)">
                    <i class="el-icon-check" @click="saveRowEventForR(scope.row,'editable2')"></i>
                    <i class="el-icon-close" @click="cancelRowEventForR(scope.row,'editable2')"></i>
                  </template>
                  <template v-else>
                    <i class="el-icon-more-outline cursor" v-show="listType === 2 && !scope.row.parentId" @click="split(scope.row,'editable')"></i>
                    <!-- <i class="el-icon-plus" @click="insertEvent(scope.row,'editable2',1)" v-show="scope.row.type==1&scope.row.expandNode&!scope.row.parentId"></i> -->
                    <!-- <i class="el-icon-more-outline" @click="split(scope.row,'editable2')" v-show="scope.row.type==1&~~scope.row.parentId!=0"></i> -->
                    <!-- <i class="el-icon-delete" @click="removeEvent(scope.row,'editable2')" v-show="~~scope.row.type==0"></i> -->
                  </template>
                </template>
              </el-editable-column>
            </el-editable>
          </el-col>
          <!-- ä»»åŠ¡å…³è”åˆ—è¡¨ -->
          <el-col :span="14" v-show="selected">
            <el-table id="relationTable" height="590" style="width: 100%" highlight-current-row :data="tableData2" header-cell-class-name="table-head-th" :cell-class-name="handleCellClassName" @row-click="clickItem">
              <el-table-column label width="45" align="center">
                <template slot-scope="scope">
                  <el-radio v-model="radio" :label="scope.row.ID" :disabled="scope.row.isRelation">
                    <i></i>
                  </el-radio>
                </template>
              </el-table-column>
              <el-table-column prop="TaskName" label="ä»»åŠ¡åç§°" align="center"></el-table-column>
              <el-table-column prop="BaseFinishTime" :formatter="handleTime" label="è®¡åˆ’å®Œæˆæ—¶é—´" align="center"></el-table-column>
              <el-table-column prop="Duration" label="å·¥æœŸ" width="45" show-overflow-tooltip align="center"></el-table-column>
            </el-table>
          </el-col>
        </el-row>
      </el-col>
      <el-col :span="12">
        <div class="one_key_matching clearfix">
          <el-button type="primary" @click="showDialog" style="float:right;">
            <img src="../../../assets/icons/match.png"> æ¸…å•ä¸€é”®åŒ¹é…
          </el-button>
        </div>
        <!-- æ¨¡å‹box -->
        <div class="model-container">
          <div ref="modelContainer" class="model-container"></div>
        </div>
      </el-col>
    </el-row>
    <!-- ä¸€é”®åŒ¹é… -->
    <el-dialog title="å­—æ®µæ˜ å°„" :visible.sync="centerDialogVisible" width="50%" center>
      <div v-if="showMapping" class="center">
        <el-row>
          <el-col :offset="5" :span="9">
            <div class="grid-content bg-purple">æ¨¡å‹</div>
          </el-col>
          <el-col :span="10">
            <div class="grid-content bg-purple-light">å·¥ç¨‹é‡æ¸…å•</div>
          </el-col>
        </el-row>
        <el-form ref="form" label-width="80px">
          <el-form-item label="æ¥¼å±‚åŒ¹é…">
            <el-select v-model="floorType.floor" placeholder="è¯·é€‰æ‹©" @change="GetFloorbyBuilding()">
              <el-option v-for="(item, idx) in options" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <el-select v-model="floorType.floor2" placeholder="è¯·é€‰æ‹©">
              <el-option v-for="(item, idx) in options4" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <div @click="addFloor()" class="add_btn"></div>
          </el-form-item>
          <!-- æ–°å¢çš„æ¥¼å±‚åŒ¹é… -->
          <el-form-item label v-for="(list, index) in addFloorType" :key="index">
            <el-select v-model="list.ModelFloor" placeholder="è¯·é€‰æ‹©" @change="GetFloorbyBuilding(list)">
              <el-option v-for="(item, idx) in ModelFloorList" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <el-select v-model="list.ListFloor" placeholder="è¯·é€‰æ‹©">
              <el-option v-for="(item, idx) in ListFloorList" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <div @click="addFloorType.splice(index, 1)" class="delete_btn"></div>
          </el-form-item>
          <el-form-item label="æ„ä»¶åŒ¹é…">
            <el-select v-model="form.artifact" placeholder="è¯·é€‰æ‹©">
              <el-option v-for="(item, idx) in elementTypeList" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <el-select v-model="form.artifact2" placeholder="è¯·é€‰æ‹©">
              <el-option v-for="(item, idx) in elementTypeNameList" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <div @click="addArtifact()" class="add_btn"></div>
          </el-form-item>
          <!-- æ–°å¢çš„æ„ä»¶åŒ¹é… -->
          <el-form-item label v-for="(list, index) in addArtifactType" :key="index">
            <el-select v-model="list.ElementType" placeholder="è¯·é€‰æ‹©">
              <el-option v-for="(item, idx) in newElementTypeList" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <el-select v-model="list.ElementName" placeholder="è¯·é€‰æ‹©">
              <el-option v-for="(item, idx) in ElementNameList" :key="idx" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <div @click="addArtifactType.splice(index, 1)" class="delete_btn"></div>
          </el-form-item>
        </el-form>
        <span slot="footer" class="dialog-footer">
          <el-button @click="centerDialogVisible = false">å– æ¶ˆ</el-button>
          <el-button class="selected" @click="ConstructAutoRalation">ä¸€é”®åŒ¹é…</el-button>
        </span>
      </div>
      <div v-if="showProgress" class="progress center">
        <el-progress type="circle" :percentage="percentage" :width="218" status="text">
          <p>åŒ¹é…å­—æ®µ</p>
          <p>88/100</p>
        </el-progress>
        <p>æ­£åœ¨è¿›è¡Œå­—æ®µåŒ¹é…ï¼Œè¯·ç¨å</p>
        <p>è¯·å‹¿è¿›è¡Œå…¶ä»–æ“ä½œï¼Œä»¥å…å‘ç”Ÿç³»ç»Ÿé”™è¯¯</p>
      </div>
      <div v-if="showResult" class="result center">
        <div class="success"></div>
        <p>æœ¬é¡¹ç›®å…±
          <span>{{totalCount}}</span> ä¸ªæ„ä»¶ï¼Œæœ¬æ¬¡æ‚¨æˆåŠŸå…³è”äº†
          <span>{{relation}}</span> ä¸ªæ„ä»¶ï¼Œå¤±è´¥
          <span>{{fail}}</span> ä¸ªï¼›</p>
        <p style="margin-bottom: 64px;">æ‚¨å¯ä»¥ç»§ç»­é€šè¿‡æ‰‹åŠ¨å…³è”çš„æ–¹å¼ï¼Œå®Œæˆå‰©ä½™æ„ä»¶çš„å…³è”ã€‚</p>
        <span slot="footer" class="dialog-footer">
          <el-button @click="rematch">é‡æ–°åŒ¹é…</el-button>
          <el-button class="selected" @click="sure">ç¡®è®¤</el-button>
        </span>
      </div>
    </el-dialog>
    <!-- æ‹†åˆ† -->
    <el-dialog title="æ‹†åˆ†" :visible.sync="splitDialogVisible" width="53%" center class="split">
      <el-row type="flex" justify="center">
        <el-col :span="8">é¡¹ç›®ç¼–ç  : {{splitProjectCode}}</el-col>
        <el-col :span="8">é¡¹ç›®åç§° : {{splitProjectName}}</el-col>
        <el-col :span="5">å·¥ä½œé‡ : {{splitWorkQuantity}}</el-col>
      </el-row>
      <el-row type="flex" justify="center">
        <el-col :span="21">
          <el-form ref="form" label-width="59px">
            <el-form-item label="æ‹†åˆ†é¡¹ : " class="fancy">
              <el-radio-group v-model="splitForm.resource" @change="tabQuantity">
                <el-radio label="æŒ‰æ¥¼å±‚æ‹†åˆ†"></el-radio>
                <el-radio label="æŒ‰æ•°é‡æ‹†åˆ†"></el-radio>
              </el-radio-group>
            </el-form-item>
            <hr>
            <!-- æŒ‰æ•°é‡æ‹†åˆ† -->
            <el-form-item label="æ•°é‡ : " class="fancy" v-if="splitForm.resource === 'æŒ‰æ•°é‡æ‹†åˆ†'">
              <el-input v-model="splitForm.quantity" type="number" placeholder="è¯·è¾“å…¥æ‹†åˆ†æ•°é‡" @blur="setQuantity"></el-input>
            </el-form-item>
            <!-- æŒ‰æ¥¼å±‚æ‹†åˆ† -->
            <el-form-item v-for="(item, idx) in cfList" :key="idx" :label="item.text">
              <el-input v-model="item.value" type="number" :placeholder="avg"></el-input>
            </el-form-item>
          </el-form>
        </el-col>
      </el-row>
      <span slot="footer" class="dialog-footer">
        <el-button @click="splitDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button class="selected" @click="comfirmSplit">ç¡®è®¤</el-button>
      </span>
    </el-dialog>
  </div>
</template>

<script type='textecmascript-6'>
  import Vue from "vue";
  import VueElementExtends from "vue-element-extends";
  import "vue-element-extends/lib/index.css";
  import XEUtils from "xe-utils";
  import { mapMutations } from "vuex";
  Vue.use(VueElementExtends);

  import {
    GetBuilding,
    GetElementTree,
    // GetAllElementList,
    GetCurrentListType,
    GetBuildImportType,
    GetBOQList,
    GetFloorbyBuilding,
    GetElementTypebyBuilding,
    GetConstructElementNamebyBuilding,
    ConstructAutoRalation,
    GetDefaultModelId,
    GetAllCostList,
    GetProjectName,
    Get_JDGH_List,
    SplitElementByFloor,
    SplitElementByNum,
    ConstructRalation,
    QueryRalationByElement,
    QueryRalationByList
  } from "@/api/api.js"

  export default {
    data () {
      return {
        splitArr: [], //æ‹†åˆ†ä¹‹åçš„æ•°ç»„
        avg: 0,
        valueArr: [], //å­˜å‚¨æ‹†åˆ†ä¹‹åå¤šä¸ªæ‹†åˆ†å€¼çš„æ•°ç»„ // ç‚¹å‡»æ‹†åˆ†ä¹‹åçš„è¡¨æ ¼æ•°æ®
        floorType: {
          floor: "", //æ¥¼å±‚åŒ¹é… æ¨¡å‹
          floor2: "" //æ¥¼å±‚åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        },
        artifactType: {
          artifact: "", //æ„ä»¶åŒ¹é… æ¨¡å‹
          artifact2: "" //æ„ä»¶åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        },
        addFloorType: [], // æ¥¼å±‚åŒ¹é…ï¼ˆå¢å‡éƒ¨åˆ†ï¼‰
        addArtifactType: [], // æ„ä»¶åŒ¹é…ï¼ˆå¢å‡éƒ¨åˆ†ï¼‰
        ModelFloorList: [],
        ListFloorList: [],
        newElementTypeList: [],
        ElementNameList: [],
        radio: "", //ä»»åŠ¡å…³è” å•é€‰
        selected: false, //æ§åˆ¶æ˜¾ç¤ºæ¸…å•å…³è”è¿˜æ˜¯ä»»åŠ¡å…³è”
        centerDialogVisible: false, //æ§åˆ¶ä¸€é”®åŒ¹é…æ¨¡æ€æ¡†æ˜¾ç¤ºä¸å¦
        splitDialogVisible: false, //æ§åˆ¶æ‹†åˆ†æ¨¡æ€æ¡†æ˜¾ç¤ºä¸å¦
        loading: false,
        currentRow: null,
        validRules: {
          //æ–°å¢è¡ŒéªŒè¯è§„åˆ™
          name: [{ required: true, message: "è¯·è¾“å…¥æ„ä»¶åç§°", trigger: "blur" }],
          m1: [{ required: true, message: "è¯·è¾“å…¥æ··å‡åœŸç Œå—", trigger: "blur" }],
          m2: [{ required: true, message: "è¯·è¾“å…¥æ¨¡æ¿é¢ç§¯", trigger: "blur" }]
        },
        validRules2: {
          //æ–°å¢è¡ŒéªŒè¯è§„åˆ™
          projectCode: [
            { required: true, message: "è¯·è¾“å…¥é¡¹ç›®ç¼–ç ", trigger: "blur" }
          ],
          projectName: [
            { required: true, message: "è¯·è¾“å…¥é¡¹ç›®åç§°", trigger: "blur" }
          ],
          workQuantity: [
            { required: true, message: "è¯·è¾“å…¥å·¥ç¨‹é‡", trigger: "blur" }
          ]
        },
        list: [],
        treeNode: [],
        treeList: [],
        array: [{
          label: "æ•´ä½“æ¨¡å‹",
          children: []
        }],
        defaultProps: {
          children: "children",
          label: "label"
        },
        options: [],
        tableData: [],
        floorId: "",
        projectid: '',  // é¡¹ç›®id
        userid: '', // ç”¨æˆ·id
        options2: [],
        value2: "",
        tableData2: [],
        options4: [],
        form: {
          floor: "",
          artifact: "",
          floor2: "",
          artifact2: ""
        },
        splitRow: "",
        splitProjectName: "", //æ‹†åˆ†æ¨¡æ€æ¡†
        splitProjectCode: "", //æ‹†åˆ†æ¨¡æ€æ¡†
        splitWorkQuantity: "", //æ‹†åˆ†æ¨¡æ€æ¡†
        columnList: [],
        elementTypeList: [], // æ„ä»¶ä¸‹æ‹‰åˆ—è¡¨
        elementTypeNameList: [], // æ„ä»¶ä¸‹æ‹‰åˆ—è¡¨2
        listType: 1, // å¯¼å…¥ç±»å‹
        floorByModel: '',
        floorByModelList: [],
        pro: '',
        projectList: [],
        splitForm: {
          resource: 'æŒ‰æ¥¼å±‚æ‹†åˆ†',
          quantity: ''
        },
        showMapping: true,
        showProgress: false,
        showResult: false,
        cfList: [],
        percentage: 0,
        totalCount: 0,
        relation: 0,
        fail: 0,
        expandedKeys: [],
        checkedKeys: [],
        sessionCheckedKeys: [],
        elementId: [],
        indexId: [],
        flog: false
      };
    },
    created () {
      this.userid = Number(localStorage.getItem('userId'))
      this.projectid = localStorage.getItem('projectid')
      this.init()
      // this.loadingModel()
    },
    methods: {
      ...mapMutations({
        modelBox: "GET_MODEL_BOX"
      }),
      init () {
        this.loading = true
        this.GetCurrentListType()
      },
      /** 
       * è·å–æ¸…å•ç±»å‹ 
       * @returns 0ä¸ºæœªå¯¼å…¥ 1ä¸ºæ–½å·¥å›¾æ¸…å• 2.å…¨è´¹ç”¨æ¸…å• 3.æ„ä»¶ç”Ÿæˆæ¸…å•
       * */
      GetCurrentListType () {
        GetCurrentListType().then(data => {
          this.listType = data.Result
          this.GetBuilding()
          if (this.listType === 1) {
            this.GetBuildImportType()
          } else if (this.listType === 2) {
            this.GetProjectName()
          } else if (this.listType === 3) {
            // 
          } else {
            this.$message('æœªå¯¼å…¥ä»»åŠ¡æ¸…å•')
          }
        })
      },
      //ç‚¹å‡»æ‹†åˆ†ä¹‹å
      split (row, ref) {
        // console.log(row)
        this.splitRow = row;
        this.splitDialogVisible = true;
        this.splitProjectName = row.ProjectName;
        this.splitProjectCode = row.ProjectCode;
        this.splitWorkQuantity = row.Quantities;
        // è·å–å½“å‰æ¥¼æ ‹ä¸‹æ‰€æœ‰æ¥¼å±‚
        GetFloorbyBuilding({ projectid: this.projectid, building: this.floorByModel }).then(data => {
          this.splitArr = data.Detiel
          this.avg = (row.Quantities / data.Detiel.length).toFixed(2)
          this.tabQuantity()
        })
      },
      // ç»Ÿä¸€è®¾ç½®æ‹†åˆ†é‡
      setQuantity () {
        this.cfList = []
        for (let i = 0; i < this.splitForm.quantity; i++) {
          this.cfList.push({
            text: '',
            value: ''
          })
          this.avg = (this.splitRow.Quantities / this.splitForm.quantity).toFixed(2)
        }
      },
      // åˆ‡æ¢æ‹†åˆ†ç±»å‹
      tabQuantity () {
        if (this.splitForm.resource === 'æŒ‰æ¥¼å±‚æ‹†åˆ†') {
          this.cfList = this.splitArr
          this.avg = (this.splitRow.Quantities / this.splitArr.length).toFixed(2)
        } else {
          this.cfList = []
          this.splitForm.quantity = ''
        }
      },
      /**
       * æ ¹æ®æ¥¼å±‚æ‹†åˆ†å·¥ç¨‹é‡
       * @param {Number} Id è¦æ‹†åˆ†çš„ID
       * @param {Array} listBOQ æ¥¼å±‚å·¥ç¨‹é‡åˆ—è¡¨
            Floor: æ¥¼å±‚,
            BOQ: å·¥ç¨‹é‡
       * @param {Number} UserId ç”¨æˆ·ID
       */
      SplitElementByFloor () {
        let param = {
          Id: this.splitRow.ID,
          listBOQ: this.valueArr,
          UserId: this.userid
        }
        SplitElementByFloor(param).then(data => {
          if (data.StatusCode === 200) {
            this.$message({ type: 'success', message: data.Message })
            this.splitDialogVisible = false
          } else {
            this.$message({ type: 'error', message: data.Message })
          }
        })
      },
      /**
      * æ ¹æ®æ•°é‡æ‹†åˆ†å·¥ç¨‹é‡
      * @param {Number} Id è¦æ‹†åˆ†çš„ID
      * @param {Array} listBOQ æ¥¼å±‚å·¥ç¨‹é‡åˆ—è¡¨
      * @param {Number} UserId ç”¨æˆ·ID
      */
      SplitElementByNum () {
        let param = {
          Id: this.splitRow.ID,
          listBOQ: this.valueArr,
          UserId: this.userid
        }
        SplitElementByNum(param).then(data => {
          if (data.StatusCode === 200) {
            this.$message({ type: 'success', message: data.Message })
            this.splitDialogVisible = false
          } else {
            this.$message({ type: 'error', message: data.Message })
          }
        })
      },
      //åœ¨æ‹†åˆ†æ¨¡æ€æ¡†å†…ç‚¹å‡»ç¡®å®šæ—¶æ ¡éªŒæ•°æ®
      comfirmSplit () {
        if (this.splitForm.resource === 'æŒ‰æ¥¼å±‚æ‹†åˆ†') {
          this.valueArr = []
          for (let i = 0; i < this.cfList.length; i++) {
            if (!this.cfList[i].value) {
              this.$message({ type: 'warning', message: 'ç¬¬' + (i + 1) + 'é¡¹ä¸èƒ½ä¸ºç©º' })
              return
            }
            this.valueArr.push({
              Floor: this.cfList[i].id,
              BOQ: this.cfList[i].value
            })
          }
          this.SplitElementByFloor()
        } else {
          if (!this.splitForm.quantity) {
            this.$message({ type: 'warning', message: 'è¯·åˆ†é…æ‹†åˆ†æ•°é‡' })
            return
          }
          this.valueArr = []
          for (let i = 0; i < this.cfList.length; i++) {
            if (!this.cfList[i].value) {
              this.$message({ type: 'warning', message: 'ç¬¬' + (i + 1) + 'é¡¹ä¸èƒ½ä¸ºç©º' })
              return
            }
            this.valueArr.push(this.cfList[i].value)
          }
          this.SplitElementByNum()
        }
        // this.splitArr
        //   .map(item => item.value) //åŠ¨æ€æ·»åŠ å±æ€§å€¼æ•°ç»„
        //   .map((item, index) => {
        //     this.valueArr.push(
        //       Object.assign(
        //         {},
        //         {},
        //         {
        //           projectCode: this.splitProjectCode,
        //           projectName: this.splitProjectName,
        //           workQuantity: item
        //         }
        //       )
        //     );
        //   });
        // console.log(this.valueArr);
        // this.splitArr.map(item => (item.value = "")); //æ‹†åˆ†ä¹‹å,å†æ¬¡ç‚¹å‡»è¿›å…¥æ‹†åˆ†æ¨¡æ€æ¡†,è¡¨å•
        // this.splitDialogVisible = false; //å…³é—­æ‹†åˆ†æ¨¡æ€æ¡†
        // this.valueArr.map(item => {
        //   console.log(item);
        //   console.log(this.splitRow);
        //   this.insertEvent(this.splitRow, "editable2", 0, item);
        // });
        // this.valueArr = [];
        // return;
      },
      // æ·»åŠ æ¥¼å±‚åŒ¹é…
      addFloor () {
        this.addFloorType.push({
          ModelFloor: "", //æ¥¼å±‚åŒ¹é… æ¨¡å‹
          ListFloor: "" //æ¥¼å±‚åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        })
        this.ModelFloorList = this.options
      },
      // æ·»åŠ æ„ä»¶åŒ¹é…
      addArtifact () {
        this.addArtifactType.push({
          ElementType: "", //æ¥¼å±‚åŒ¹é… æ¨¡å‹
          ElementName: "" //æ¥¼å±‚åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        });
      },
      //è·å–é€‰ä¸­çš„æ ‘èŠ‚ç‚¹ç»„æˆçš„æ•°ç»„
      getCheckedKeys () {
        this.multipleSelection = this.$refs.tree.getCheckedNodes(true)
        if (this.multipleSelection.length) {
          if (this.indexId.length) {
            let param = []
            this.multipleSelection.forEach(item => {
              this.indexId.forEach(obj => {
                param.push({
                  ElementID: item.elementId,
                  IndexId: obj
                })
              })
            })
            this.ConstructRalation(param)
          } else {
            this.$message({ type: 'warning', message: 'è¯·é€‰æ‹©æ¸…å•' })
          }
        } else {
          this.$message({ type: 'warning', message: 'è¯·é€‰æ‹©æ„ä»¶' })
        }
      },
      /**
       *  æ„ä»¶çš„å…³è” 
       *  @param {Number} userid ç”¨æˆ·ID
       *  @param {Number} type ç±»å‹ 1.ä¸ºæ–½å·¥å›¾çš„å…³è” 2.ä¸ºå…¨è´¹ç”¨æ¸…å•çš„å…³è”
       *  @param {Number} ElementID æ„ä»¶ID
       *  @param {Number} IndexId æ¸…å•ID
       */
      ConstructRalation (param) {
        let userid = this.userid
        let type = this.listType
        ConstructRalation(userid, type, param).then(data => {
          this.$message({ type: 'success', message: data.Message })
        })
      },
      /**
       *  æ ¹æ®æ„ä»¶è·å–æ„ä»¶å…³è”çš„ä¿¡æ¯
       *  @param {Array} param æ„ä»¶idé›†åˆ
       */
      QueryRalationByElement () {
        if (this.flog) return
        this.flog = true
        let param = []
        let treeList = this.$refs.tree.getCheckedNodes(true)
        if (treeList.length) {
          treeList.forEach(item => {
            param.push(item.elementId)
          })
          QueryRalationByElement(param).then(data => {
            // console.log(this.array)
            // data.Detiel
            this.flog = false
          })
        }
      },
      /**
      *  æ ¹æ®æ¸…å•IDè·å–æ„ä»¶å…³è”çš„ä¿¡æ¯
      *  @param {Array} this.indexId æ¸…å•idé›†åˆ
      */
      QueryRalationByList () {
        QueryRalationByList(this.indexId).then(data => {
          let res = data.Detiel
          this.sessionCheckedKeys = JSON.parse(JSON.stringify(res))
          this.checkedKeys = []
          res.forEach(item => {
            this.findLastChild(item, this.array)
          })
          console.log(this.checkedKeys)
        })
      },
      /**
       * æ‰¾åˆ°æœ€åä¸€çº§æ ‘èŠ‚ç‚¹
       * åŒ¹é…ä¸Šåˆ™é€‰ä¸­ä¸”ç¦ç”¨
       * @param {Array} item éœ€è¦åŒ¹é…çš„å¯¹è±¡
       * @param {Array} arr éœ€è¦æŸ¥æ‰¾çš„æ•°æ®é›†åˆ
       */
      findLastChild (item, arr, isTrue) {
        arr.forEach(obj => {
          if (obj.children && obj.children.length) {
            this.findLastChild(item, obj.children, isTrue)
          } else {
            if (item.ElementID === obj.elementId) {
              if (isTrue) {
                obj.disabled = false
                // æ¸…ç©ºé»˜è®¤é€‰æ‹©èŠ‚ç‚¹
                this.$refs.tree.setCheckedNodes([])
              } else {
                obj.disabled = true
                this.checkedKeys.push(obj.id)
              }
            }
          }
        })
      },
      //è·å–é€‰ä¸­è¡¨æ ¼ä¸­çš„æ•°æ®ç»„æˆçš„æ•°ç»„
      handleSelectionChange (val) {
        this.multipleSelection = val.map(val => val.id)
        // console.log(this.multipleSelection);
      },
      setCurrent (row) {
        this.$refs.singleTable.setCurrentRow(row);
      },
      // å½“æŸä¸€è¡Œè¢«ç‚¹å‡»æ—¶ä¼šè§¦å‘è¯¥äº‹ä»¶
      clickItem (row) {
        if (row.isRelation) return
        this.radio = row.ID
      },
      //è·å–è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
      getChildren (row) {
        return this.treeList.filter(item => item.parentId === row.id);
      },
      /**
       * é‡æ–°æ¸²æŸ“æ ‘è¡¨æ ¼
       */
      reloedTreeList (data) {
        this.initTreeList(data, true);
      },
      /** 
       * å°†ä¸€ä¸ªå¸¦å±‚çº§çš„æ•°æ®åˆ—è¡¨è½¬æˆæ ‘ç»“æ„
       */
      initTreeList (data, isReload) {
        // toArrayTree ( array, options ) ä¸€ä¸ªé«˜æ€§èƒ½çš„æ ‘ç»“æ„è½¬æ¢å‡½æ•°ï¼Œå°†ä¸€ä¸ªå¸¦å±‚çº§çš„æ•°æ®åˆ—è¡¨è½¬æˆæ ‘ç»“æ„
        let treeNode = XEUtils.toArrayTree(data, { strict: true, key: 'id', parentKey: 'parentId', children: 'children' })
        // toTreeArray ( array, options ) å°†ä¸€ä¸ªæ ‘ç»“æ„è½¬æˆæ•°ç»„åˆ—è¡¨
        let treeList = XEUtils.toTreeArray(treeNode, { children: "children" })
        if (!isReload) {
          treeList.forEach(item => {
            Object.assign(item, {
              expandNode: false,
              showNode: false,
              isCheck: false,
              indeterminate: false
            });
          });
        }
        this.treeNode = treeNode; // ç›®å½•èŠ‚ç‚¹
        this.treeList = treeList; // å…¨éƒ¨èŠ‚ç‚¹
        if (!isReload) {
          treeNode.forEach((item, index) => {
            Object.assign(item, {
              treeLevel: 0,
              treeIndex: index,
              showNode: true
            });
          });
        }
        this.loadTree();
      },
      loadTree () {
        this.list = this.treeList.filter(item => item.showNode); // ç›®å½• list
      },
      // åˆ¤æ–­è¡¨æ ¼å±•å¼€ä¸å¦çš„å›¾æ ‡æ ·å¼
      treeIcons (row) {
        let clsName = row.parentId === null ? row.expandNode ? "el-icon-caret-bottom" : "el-icon-caret-top" : ""
        return clsName
      },
      //åˆ¤æ–­ä¸€æ¡æ•°æ®æ˜¯å¦è¢«é€‰ä¸­
      treeNodeChange (row) {
        if (row.isCheck) {
          row.indeterminate = false
          this.indexId.push(row.IndexId)
          this.QueryRalationByList()
        } else {
          this.sessionCheckedKeys.forEach(item => {
            this.findLastChild(item, this.array, true)
          })
          if (this.indexId.length > 0) {
            this.indexId = this.indexId.filter(item => item !== row.IndexId)
          }
        }
      },
      // åˆ‡æ¢ å±•å¼€ç›®å½•çš„é€»è¾‘
      treeCollapseNode (parent, expand) {
        let children = this.treeList.filter(item => item.parentId === parent.id);
        parent.expandNode = !!(expand && children.length);
        children.forEach((child, index) => {
          child.treeIndex = index;
          child.treeLevel = parent.treeLevel + 1;
          child.showNode = expand !== null ? expand : false;
          this.treeCollapseNode(child, null);
        });
      },
      // åˆ‡æ¢ ç›®å½•çš„æ ·å¼
      treeRowClassName ({ row }) {
        let clsName = `tree-level_${row.treeLevel}`;
        if (this.currentRow && this.currentRow.id === row.id) {
          clsName += " current-row";
        }
        return clsName;
      },
      // åˆ‡æ¢ å±•å¼€ç›®å½•
      toggleCollapseNode (row) {
        this.treeCollapseNode(row, !row.expandNode);
        this.loadTree();
      },
      rowClickEvent (row) {
        this.currentRow = row;
      },
      /**
       * selectRow:æ–°å¢çš„ä¸€è¡Œæ•°æ®çš„çˆ¶çº§æ•°æ®
       * file:æ–°å¢çš„ä¸€è¡Œæ•°æ®
       * type:0->ç›®å½•,1->æ–‡ä»¶
       */
      insertEvent (selectRow, ref, type = 1, file) {
        if (!this.$refs[ref].checkValid().error) {
          let children = []
          let isAppand = true
          let index = selectRow ? XEUtils.findIndexOf(this.list, item => item.id === selectRow.id) : 0
          let data = Object.assign(
            {
              isNew: true,
              id: this.treeList.length + 1,
              parentId: null,
              treeLevel: 0,
              treeIndex: 0,
              expandNode: false,
              showNode: true,
              isCheck: false,
              indeterminate: false
            },
            file
          )
          if (selectRow) {
            children = this.getChildren(selectRow)
            if (isAppand) {
              selectRow.expandNode = true //å±•å¼€
              data.parentId = selectRow.id //è¢«é€‰ä¸­è¡Œæ•°æ®çš„idå°±æ˜¯æ’å…¥æ•°æ®çš„çˆ¶id
              data.treeLevel = selectRow.treeLevel + 1
            } else {
              data.parentId = selectRow.parentId
              data.treeLevel = selectRow.treeLevel
            }
          }
          //ç¬¬äºŒä¸ªå‚æ•°å¦‚æœæ˜¯ row æˆ– $index åˆ™åœ¨æŒ‡å®šä½ç½®æ–°å¢ä¸€æ¡æ•°æ®ï¼Œå¦‚æœæ˜¯ -1 åˆ™ä»æœ€åæ–°å¢ä¸€æ¡æ•°æ®
          let row = this.$refs[ref].insertAt(data, index)
          this.currentRow = row;
          this.$nextTick(() => {
            if (selectRow) {
              let dataIndex = XEUtils.findIndexOf(this.treeList, item => item.id === selectRow.id)
              // å‘æ•°ç»„æ·»åŠ æ–°é¡¹ç›®ã€‚
              this.treeList.splice(isAppand ? dataIndex + children.length + 1 : dataIndex, 0, row)
            } else {
              this.treeList.push(row)
            }
            this.reloedTreeList(this.treeList)
            if (!file) {
              this.$nextTick(() => this.$refs[ref].setActiveRow(row)) //   åªå¯¹ mode=row æœ‰æ•ˆï¼Œæ¿€æ´»æŒ‡å®šè¡Œè¡Œä¸ºå¯ç¼–è¾‘çŠ¶æ€
            }
          });
        }
      },
      // å–æ¶ˆä¿å­˜å½“å‰ç¼–è¾‘è¡Œ ğŸ™‚
      cancelRowEvent (row, ref) {
        let activeInfo = this.$refs[ref].getActiveRow(); // getActiveRow è·å–å½“å‰æ´»åŠ¨è¡Œæˆ–åˆ—çš„ä¿¡æ¯
        if (activeInfo && activeInfo.isUpdate) {
          this.$confirm("è¯¥æ•°æ®æœªä¿å­˜ï¼Œæ˜¯å¦ç§»é™¤?", "æ¸©é¦¨æç¤º", {
            confirmButtonText: "ç§»é™¤æ•°æ®",
            cancelButtonText: "è¿”å›ç»§ç»­",
            type: "warning"
          })
            .then(action => {
              if (action === "confirm") {
                this.treeList = this.treeList.filter(item => item.id !== row.id); // ä»ç¼“å­˜æ ‘ä¸­ç§»é™¤
                this.reloedTreeList(this.treeList); //é‡æ–°åŠ è½½ç¼“å­˜æ ‘
              } else {
                this.$refs[ref].setActiveRow(row); //  åªå¯¹ mode=row æœ‰æ•ˆï¼Œæ¿€æ´»æŒ‡å®šè¡Œè¡Œä¸ºå¯ç¼–è¾‘çŠ¶æ€
              }
            })
            .catch(e => {
              this.$nextTick(() => this.$refs[ref].setActiveRow(row))
            })
            .then(() => {
              // this.isClearActiveFlag = true
            })
        } else {
          this.$refs[ref].clearActive();
        }
      },
      // ç§»é™¤å½“å‰è¡Œ ğŸ™‚
      // ç›®å‰éœ€æ±‚ä¸éœ€è¦æ­¤åŠŸèƒ½
      removeEvent (row, ref) {
        this.$confirm("ç¡®å®šåˆ é™¤è¯¥è¡Œæ•°æ®?", "æ¸©é¦¨æç¤º", {
          confirmButtonText: "ç¡®å®š",
          cancelButtonText: "å–æ¶ˆ",
          type: "warning"
        })
          .then(() => {
            // this.$refs[ref].remove(row); // é¦–å…ˆåœ¨ ref ä¸­åˆ é™¤ row
            // console.log(this.treeList)
            // this.treeList = this.treeList.filter(item => item.id !== row.id); // ç„¶åä¸€å®šè¦åœ¨ this.treeList ä¸­åˆ é™¤ row  // è§£å†³æ— æ³•æˆåŠŸåˆ é™¤æ•°æ®
            // this.updateRowEvent(row);
            // this.reloedTreeList(this.treeList); //é‡æ–°åŠ è½½ç¼“å­˜æ ‘
            this.tableData.forEach((item, idx) => {
              if (item.RowId === row.RowId) {
                this.tableData.splice(idx, 1)
              }
            })
          })
          .catch(e => e);
      },
      clearActiveEvent (row) {
        this.updateRowEvent(row);
      },
      //æ›´æ–°æ ‘è¡¨æ ¼æ•°æ®
      updateRowEvent (row) {
        // this.$refs[ref].reloadRow(row); // reloadRow() åˆå§‹åŒ–æŒ‡å®šè¡Œæ•°æ®
        this.$message({ message: "ä¿å­˜æˆåŠŸ", type: "success" });
      },
      //ä¿å­˜å½“å‰ç¼–è¾‘è¡Œ
      saveRowEvent (row, ref) {
        // console.log(row);
        this.$refs[ref].validateRow(row, valid => {
          if (valid) {
            this.$refs[ref].clearActive(); //æ¸…é™¤æ‰€æœ‰æ´»åŠ¨è¡Œæˆ–åˆ—ä¸ºä¸å¯ç¼–è¾‘çŠ¶æ€
            this.$refs[ref].reloadRow(row); //åˆå§‹åŒ–æŒ‡å®šè¡Œæ•°æ®
            Message({ message: "ä¿å­˜æˆåŠŸ", type: "success" });
          } else {
            this.$refs[ref].revert(row); // æ”¾å¼ƒæ›´æ”¹ï¼Œè¿˜åŸæŒ‡å®šè¡Œ row æˆ–è€…æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®
          }
        });
      },
      /**
       * æ ¹æ®æ¥¼æ ‹è·å–é¡¹ç›®åç§°
       * @param {String} BuildName
       */
      GetProjectName () {
        GetProjectName({ BuildName: this.floorByModel }).then(data => {
          this.projectList = data.Detiel
        })
      },
      /**
       * è·å–æ‰€æœ‰çš„è´¹ç”¨æ¸…å•åˆ—è¡¨æ•°æ®
       * @param {string} projectid
       * @param {Number} userid
       * @param {string} buildname  æ¥¼æ ‹
       * @param {string} name åç§°
       */
      GetAllCostList () {
        let param = {
          projectid: this.projectid,
          userid: this.userid,
          buildname: this.floorByModel,
          name: this.pro
        }
        GetAllCostList(param).then(data => {
          this.list = data.Detiel
          // this.list[0].isDisabled = true
          // this.list[1].isDisabled = true
        })
      },
      /**
       * è·å–æ¥¼æ ‹ä¿¡æ¯
       * @param {String} projectid é¡¹ç›®id
       */
      GetBuilding () {
        GetBuilding({ projectid: this.projectid }).then(data => {
          this.floorByModelList = JSON.parse(JSON.stringify(data.Detiel))
          this.options = data.Detiel
          this.options.unshift({ id: '', text: 'å…¨éƒ¨' })
          this.GetElementTree()
        })
      },
      /**
       * è·å–æ„ä»¶æ ‘ç»“æ„
       * @param {String} projectid  é¡¹ç›®ID
       * @param {String} buildname  æ¥¼æ ‹
       * @param {Number} ordertype	æ’åºç±»å‹ 1.ä¸ºæ¥¼å±‚åœ¨ä¸Šé¢ï¼ˆæ–½å·¥å›¾ï¼‰ 2ä¸ºæ¥¼å±‚åœ¨ä¸‹é¢ï¼ˆå…¨è´¹ç”¨ï¼‰
       */
      GetElementTree () {
        let param = {
          projectid: this.projectid,
          buildname: this.floorId,
          ordertype: this.listType
        }
        GetElementTree(param).then(data => {
          let arr = data.Detiel
          let newArr = []
          let parentList = []
          arr.forEach(item => {
            parentList.push(item.BuildingName)
          })
          // ä¸€çº§æ¥¼æ ‹
          parentList = [...new Set(parentList)]
          parentList.forEach(item => {
            this.expandedKeys.push(item)
            newArr.push({
              id: item,
              label: item,
              children: []
            })
          })
          // äºŒçº§ä¸“ä¸š
          newArr.forEach(item => {
            arr.forEach(obj => {
              if (obj.BuildingName === item.id) {
                item.children.push({
                  id: obj.Specialty,
                  label: obj.Specialty,
                  parentId: item.id,
                  children: []
                })
              }
            })
            let temp = {}
            item.children = item.children.reduce((item, next) => {
              temp[next.id] ? '' : temp[next.id] = true && item.push(next)
              return item
            }, [])
          })
          // ä¸‰çº§æ¥¼å±‚
          newArr.forEach(item => {
            item.children.forEach(treeItem => {
              arr.forEach(fromArr => {
                if (fromArr.Specialty === treeItem.id) {
                  treeItem.children.push({
                    id: fromArr.Floor,
                    label: fromArr.Floor,
                    parentId: treeItem.id,
                    children: []
                  })
                }
              })
              let temp = {}
              treeItem.children = treeItem.children.reduce((item, next) => {
                temp[next.id] ? '' : temp[next.id] = true && item.push(next)
                return item
              }, [])
            })
          })
          // å››çº§æ—
          newArr.forEach(item => {
            item.children.forEach(treeItem => {
              treeItem.children.forEach(fourItem => {
                arr.forEach(fromArr => {
                  if (fromArr.Floor === fourItem.id) {
                    fourItem.children.push({
                      id: fromArr.FamilyName,
                      label: fromArr.FamilyName,
                      parentId: fourItem.id,
                      children: []
                    })
                  }
                })
                let temp = {}
                fourItem.children = fourItem.children.reduce((item, next) => {
                  temp[next.id] ? '' : temp[next.id] = true && item.push(next)
                  return item
                }, [])
              })
            })
          })
          // äº”çº§æ—ç±»å‹
          newArr.forEach(item => {
            item.children.forEach(treeItem => {
              treeItem.children.forEach(fourItem => {
                fourItem.children.forEach(fiveItem => {
                  arr.forEach(fromArr => {
                    if (fromArr.FamilyName === fiveItem.id) {
                      fiveItem.children.push({
                        id: fromArr.FamilyTypeName,
                        label: fromArr.FamilyTypeName,
                        elementId: fromArr.RaletionElementID,
                        parentId: fourItem.id
                      })
                    }
                  })
                  let temp = {}
                  fiveItem.children = fiveItem.children.reduce((item, next) => {
                    temp[next.id] ? '' : temp[next.id] = true && item.push(next)
                    return item
                  }, [])
                })
              })
            })
          })
          // console.log(newArr)
          this.array = newArr
          this.loading = false
        })
      },
      /**
       * æ ¹æ®æ¥¼æ ‹è·å–æ¨¡å‹çš„æ¥¼å±‚
       * @param {string} projectid é¡¹ç›®id
       * @param {string} building æ¥¼æ ‹åç§°
       */
      GetFloorbyBuilding (list) {
        GetFloorbyBuilding({ projectid: this.projectid, building: list ? list.ModelFloor : this.floorType.floor }).then(data => {
          if (!list) {
            this.floorType.floor2 = ''
            this.options4 = data.Detiel
          } else {
            this.ListFloorList = data.Detiel
          }
          this.GetElementTypebyBuilding(list)
          this.GetConstructElementNamebyBuilding(list)
        })
      },
      /**
       * æ ¹æ®æ¥¼æ ‹è·å–æ¨¡å‹çš„æ¥¼å±‚çš„æ„ä»¶ç±»å‹
       * @param {string} projectid é¡¹ç›®id
       * @param {string} building æ¥¼æ ‹åç§°
       */
      GetElementTypebyBuilding (list) {
        GetElementTypebyBuilding({ projectid: this.projectid, building: list ? list.ModelFloor : this.floorType.floor }).then(data => {
          if (!list) {
            this.elementTypeList = data.Detiel
          } else {
            this.newElementTypeList = data.Detiel
          }
        })
      },
      /**
       * æ ¹æ®æ¥¼æ ‹è·å–æ–½å·¥å›¾çš„æ„ä»¶åç§°
       * @param {string} projectid é¡¹ç›®id
       * @param {string} buildname æ¥¼æ ‹åç§°
       */
      GetConstructElementNamebyBuilding (list) {
        GetConstructElementNamebyBuilding({ projectid: this.projectid, buildname: list ? list.ModelFloor : this.floorType.floor }).then(data => {
          if (!list) {
            this.elementTypeNameList = data.Detiel
          } else {
            this.ElementNameList = data.Detiel
          }
        })
      },
      /**
       * è·å–æ–½å·¥å›¾æ¸…å•å¯¼å…¥ä¸­æ¥¼æ ‹å’Œå¯¼å…¥ç±»å‹ï¼ˆæ–½å·¥å›¾ä¸‹æ‹‰åˆ—è¡¨ï¼‰
       * @param {String} projectid é¡¹ç›®id
       */
      GetBuildImportType () {
        GetBuildImportType({ projectid: this.projectid }).then(data => {
          this.options2 = data.Detiel
          this.value2 = data.Detiel[0].ImportType
          this.GetBOQList()
        })
      },
      /**
       * è·å–é¢„ç®—æ¸…å•æ•°æ®
       * @param {String} projectid é¡¹ç›®ID
       * @param {String} type å¯¼å…¥ç±»å‹
       */
      GetBOQList () {
        let param = {
          pageIndex: 1,
          pageSize: 9999,
          buildname: '',
          floor: '',
          elementname: '',
          projectid: this.projectid,
          type: this.value2
        }
        GetBOQList(param).then(data => {
          this.tableData = data.Result
          let map = {}
          let dest = []
          data.Result.forEach(item => {
            if (!map[item['æ¥¼å±‚']]) {
              dest.push({
                id: item['æ¥¼å±‚'],
                parentId: null,
                'æ„ä»¶åç§°': item['æ¥¼å±‚']
              })
              map[item['æ¥¼å±‚']] = item;
            } else {
              item.id = item['RowId']
              item.parentId = item['æ¥¼å±‚']
            }
          })
          let tempArr = dest.concat(data.Result)
          this.initTreeList(tempArr)
          // åŠ¨æ€ç”Ÿæˆè¡¨å¤´
          let list = Object.keys(data.Result[0])
          this.columnList = list.filter(item => item !== 'åºå·' && item !== 'æ¥¼å±‚' && item !== 'RowId' && item !== 'expandNode' && item !== 'indeterminate' && item !== 'isCheck' && item !== 'showNode' && item !== 'treeIndex' && item !== 'treeLevel' && item !== 'id' && item !== 'parentId' && item !== 'children')
          this.loading = false
        })
      },
      /**
       * æ–½å·¥å›¾ä¸€é”®å…³è”
       * @param {String} modelbuiling æ¨¡å‹æ¥¼æ ‹
       * @param {Array} listFloor æ¥¼å±‚åŒ¹é…
       *    ModelFloor: '', // æ¨¡å‹ä¸­æ¥¼å±‚
       *    ListFloor: ''   // æ¸…å•ä¸­æ¥¼å±‚
       * @param {Array} listElement æ„ä»¶åŒ¹é…
       *    ElementType: '' // æ¨¡å‹ä¸­æ„ä»¶ç±»å‹
       *    ElementName: '' // æ„å»ºåç§°
       * @param {String} projectid é¡¹ç›®id
       * @param {Number} userid ç”¨æˆ·id
       */
      async ConstructAutoRalation () {
        this.percentage = 0
        this.showMapping = false
        this.showProgress = true
        let defaultModelId = await this.Request(GetDefaultModelId({ projectId: this.projectid }))
        let listFloor = []
        let listElement = []
        listFloor = this.addFloorType.concat([{
          ModelFloor: this.floorType.floor,
          ListFloor: this.floorType.floor2
        }])
        listElement = this.addArtifactType.concat([{
          ElementType: this.form.artifact,
          ElementName: this.form.artifact2
        }])
        let param = {
          modelbuiling: defaultModelId.Result,
          listFloor: listFloor,
          listElement: listElement,
          projectid: this.projectid,
          userid: this.userid
        }
        ConstructAutoRalation(param).then(data => {
          this.totalCount = 300
          this.relation = 180
          this.fail = 120
          let timer = setInterval(() => {
            this.percentage++
            if (this.percentage >= 100) {
              clearTimeout(timer)
              let timeJump = setTimeout(() => {
                clearTimeout(timeJump)
                this.showProgress = false
                this.showResult = true
              }, 1000)
            }
          }, 50)
        })
      },
      showDialog () {
        this.showMapping = true
        this.centerDialogVisible = true
      },
      // é‡æ–°åŒ¹é…
      rematch () {
        this.showResult = false
        this.showMapping = true
      },
      sure () {
        this.showResult = false
        this.showProgress = false
        this.showMapping = false
        this.centerDialogVisible = false
      },
      // å¤„ç†æ ‘èŠ‚ç‚¹ç‚¹å‡»äº‹ä»¶
      handleCheckChange (data, checked, indeterminate) {
        this.QueryRalationByElement()
      },
      /**
       * è·å–è¿›åº¦è§„åˆ’åˆ—è¡¨
       * @param {String} ProjectID
       */
      Get_JDGH_List () {
        Get_JDGH_List({ ProjectID: this.projectid }).then(data => {
          this.tableData2 = data.Detiel
          // æ¨¡æ‹Ÿå…³è”åçš„æ•°æ®
          this.tableData2[0].isRelation = true
          this.tableData2[6].isRelation = true
        })
      },
      // åˆ‡æ¢å…³è”
      tabList (bool) {
        if (this.selected !== bool) {
          if (this.listType === 1) {
            this.GetBuildImportType()
          } else if (this.listType === 2) {
            this.GetProjectName()
          }
          this.selected = bool
          if (bool) {
            this.Get_JDGH_List()
          }
        }
      },
      // å¤„ç†æ—¶é—´
      handleTime (item) {
        return new Date(item.BaseFinishTime).toLocaleDateString()
      },
      // å¤„ç†å·²å…³è”ä»»åŠ¡çš„ç¦ç”¨æ ·å¼
      handleCellClassName (item) {
        return item.row.isRelation ? 'disabled-row' : 'disabled-none'
      },
      /**
       * åŠ è½½æ¨¡å‹
       */
      loadingModel () {
        this.$nextTick(() => {
          this.$util.getDomLocation(this, "modelContainer").then(res => {
            // console.log(res)
            this.modelBox({
              isShowModel: true, //æ˜¯å¦æ˜¾ç¤ºæ¨¡å‹ true:æ˜¾ç¤ºæ¨¡å‹ï¼Œå¦‚æœæ¨¡å‹å·²åŠ è½½ï¼Œåˆ™æ˜¾ç¤º  false:éšè—æ¨¡å‹
              isLoadModel: true, //æ˜¯å¦åŠ è½½æ¨¡å‹  trueï¼šåŠ è½½æ¨¡å‹ï¼Œå¦‚æœå·²ç»åŠ è½½ï¼Œä¸ä¼šé‡æ–°åŠ è½½ï¼Œ  false:å¸è½½æ¨¡å‹
              top: res.top, //è·ç¦»é¡¶éƒ¨è·ç¦»â€˜px'
              left: res.left, //è·ç¦»å·¦è¾¹è·ç¦»â€˜px'
              width: res.width, //æ¨¡å‹å®½â€˜px'
              height: res.height, //æ¨¡å‹é«˜ â€˜px'
              zIndex: 100, //æ¨¡å‹å±‚çº§
              background: "",
              ElementIDs: [], // æ‰€æœ‰è¦æ˜¾ç¤ºçš„æ„ä»¶æ•°ç»„ï¼ŒåŒ…æ‹¬åŠéšè—æ„ä»¶
              highLightElementIDs: [], // é«˜äº®æ˜¾ç¤ºçš„æ„ä»¶
              functionNumber: [] // éœ€è¦æ¨¡å‹è°ƒç”¨çš„å‡½æ•°ç¼–å·æ•°ç»„
            })
          })
        })
      }
    }
  };
</script>

<style>
  .container-artifacts-associated * {
    font-size: 28px; /*px*/
  }
  .container-artifacts-associated
    .el-col-14
    .el-select
    .el-input
    .el-select__caret {
    color: #fff;
  }
  .container-artifacts-associated .el-dialog__body {
    height: 600px;
  }
  .container-artifacts-associated .el-col-14 .el-input__inner::placeholder {
    color: #fff;
  }

  .container-artifacts-associated .el-progress {
    margin: 100px 0 60px 0;
  }

  .container-artifacts-associated .progress p {
    line-height: 30px;
    font-size: 18px;
    color: rgba(153, 153, 153, 1);
  }

  .container-artifacts-associated .progress .el-progress__text p {
    font-size: 20px;
    color: rgba(71, 117, 202, 1);
  }

  .container-artifacts-associated .center {
    text-align: center;
  }

  .container-artifacts-associated
    .el-row:nth-child(2)
    .el-col:nth-child(2)
    .el-input--suffix
    .el-input__inner {
    background: #435089;
    color: #fff;
  }

  .container-artifacts-associated .el-table .table-head-th {
    background-color: #435089;
    color: white;
    text-align: center;
    border-bottom: none;
  }

  .container-artifacts-associated .el-table .disabled-row {
    color: rgba(153, 153, 153, 1);
    cursor: not-allowed;
  }

  .container-artifacts-associated .el-table .disabled-none {
    cursor: pointer;
  }

  .container-artifacts-associated #relationTable .gutter {
    background-color: #435089;
    color: white;
  }
  /* select ä¸‹æ‹‰æŒ‰æŒ‰é’® */
  .container-artifacts-associated .el-dialog .el-select {
    flex: 1;
    height: 40px;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0px 3px 7px 0px rgba(229, 229, 229, 1);
    border-radius: 4px;
  }
  .container-artifacts-associated .el-dialog .el-input--suffix .el-input__inner {
    border: none;
  }
  .container-artifacts-associated .el-dialog .el-input__suffix {
    background: rgba(67, 80, 137, 1);
    border-radius: 0px 4px 4px 0px;
    right: 0;
    width: 40px;
  }
  .container-artifacts-associated .el-dialog .el-icon-arrow-up:before {
    /* content: "\e60b"; */
    content: "\e60c";
    /* font-size: 20px; */
    color: rgba(255, 255, 255, 1);
  }
  .container-artifacts-associated .el-dialog .center-select {
    margin: 0 20px;
  }
  .container-artifacts-associated
    .input-number
    .el-input-group--append
    .el-input__inner,
  .container-artifacts-associated .el-input-group__prepend {
    height: 40px;
    background: rgba(248, 248, 248, 1);
    border-radius: 4px;
    border: 1px solid rgba(229, 229, 229, 1);
    border-right: 1px dashed #979797;
  }
  .container-artifacts-associated .editable-required-icon,
  .container-artifacts-associated .el-icon-edit-outline {
    display: none;
  }
  tbody .el-table__row:nth-child(1) {
    background: #f4f6ff;
  }
  .split .fancy {
    display: block;
  }
  .split .el-form-item:not(.fancy) {
    display: inline-block;
  }
  .split .el-form-item__label {
    margin: 0.1rem 0;
  }
  .split .el-input {
    width: 110px;
  }
  .container-artifacts-associated .el-dialog__header {
    background: linear-gradient(
      225deg,
      rgba(105, 86, 255, 1) 0%,
      rgba(84, 138, 255, 1) 100%
    );
  }
  .container-artifacts-associated .el-dialog__title {
    color: #fff;
  }
  .container-artifacts-associated .el-radio__input.is-checked .el-radio__inner {
    border-color: #fca141;
    background: #fca141;
  }

  .container-artifacts-associated .el-radio__input.is-checked + .el-radio__label {
    color: #fca141;
  }

  .container-artifacts-associated
    .el-checkbox__input.is-checked
    .el-checkbox__inner,
  .container-artifacts-associated
    .el-checkbox__input.is-indeterminate
    .el-checkbox__inner {
    background-color: #fca141;
    border-color: #fca141;
  }
</style>

<style lang='stylus' scoped rel='stylesheet/stylus'>
  * {
    font-size: 18px;
  }

  .model-container {
    height: 866px;
    padding-top: 25px;
  }

  .tree_height {
    height: 590px;
    overflow: auto;
  }

  .one_key_matching {
    height: 40px;
    z-index: 101;
  }

  .container-artifacts-associated {
    // width: 100%;
    // height: 100%;
    padding: 0 20px;

    .result {
      .success {
        width: 232px;
        height: 232px;
        background: url('../../../assets/imgs/success.png') no-repeat;
        background-size: cover;
        margin: 100px auto 50px auto;
      }

      p {
        line-height: 30px;
        font-size: 18px;
        color: rgba(153, 153, 153, 1);

        span {
          color: rgba(71, 116, 202, 1);
        }
      }
    }
  }

  .container-artifacts-associated .el-row {
    margin: 20px 0;
  }

  .container-artifacts-associated .el-row:nth-child(2) .el-col:nth-child(1), .container-artifacts-associated .el-row:nth-child(2) .el-col:nth-child(2) {
    height: 100%;
    background: rgba(255, 255, 255, 1);
  }

  .container-artifacts-associated .el-row:nth-child(2) .el-col header {
    width: 100%;
    background: #435089;
    color: white;
    text-align: center;
    padding: 0.1rem 0;
  }

  .container-artifacts-associated .el-row:nth-child(2) .el-col .el-select {
    width: 100%;
    height: 50px;
    color: white;
    text-align: center;
  }

  .selected {
    background: #4775CA;
    color: white;
  }

  .el-form {
    height: 500px;
    overflow-y: auto;
  }

  .el-form-item {
    div {
      margin: 0.1rem 0.6rem;
    }
  }

  .add_btn, .delete_btn {
    background: url('../../../assets/icons/add.png') center 60% no-repeat;
    width: 0.5rem;
    height: 0.5rem;
    display: inline-block;
    float: right;
  }

  .delete_btn {
    background: url('../../../assets/icons/reduce.png') center 60% no-repeat;
  }

  .container-artifacts-associated .el-dialog__head {
    background: linear-gradient(
      225deg,
      rgba(105, 86, 255, 1) 0%,
      rgba(84, 138, 255, 1) 100%
    );
    color: white;
    /* height: 40px; */
  }

  .cursor {
    cursor: pointer;
  }
</style>