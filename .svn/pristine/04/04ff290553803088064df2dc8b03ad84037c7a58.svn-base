<!-- artifactsAssociatedä»»åŠ¡å…³è” -->
<template>
  <div class="container-artifacts-associated">
    <el-row>
      <el-col :span="12">
        <div>
          <el-button @click="selected=false" :class="{selected:!selected}">æ¸…å•å…³è”</el-button>
          <el-button @click="selected=true" :class="{selected:selected}">ä»»åŠ¡å…³è”</el-button>
          <el-button type="warning" @click="getCheckedKeys" style="float:right">ç¡®è®¤å…³è”</el-button>
        </div>
        <el-row :gutter="20">
          <el-col :span="10">
            <header>æ„ä»¶æ¸…å•</header>
            <el-select v-model="floorId" placeholder="è¯·é€‰æ‹©" id="select1" @change="GetAllElementList">
              <el-option v-for="item in options" :key="item.id" :label="item.text" :value="item.id"></el-option>
            </el-select>
            <el-tree :data="array" show-checkbox default-expand-all node-key="id" ref="tree" highlight-current :props="defaultProps"></el-tree>
          </el-col>
          <el-col :span="14" v-show="!selected">
            <el-select v-model="value2" placeholder="è¯·é€‰æ‹©" @change="GetBOQList">
              <el-option v-for="(item, idx) in options2" :key="idx" :label="item.ImportType" :value="item.ImportType"></el-option>
            </el-select>
            <el-editable v-if="value2!=1" ref="editable" :edit-config="{trigger: 'manual', mode: 'row'}" :edit-rules="validRules" :data.sync="tableData" @row-click="rowClickEvent">
              <!-- <el-editable-column label width="45">
                <template slot-scope="scope">
                  <i :class="treeIcons(scope.row)" @click="toggleCollapseNode(scope.row)"></i>
                  <el-checkbox v-model="scope.row.isCheck" :indeterminate="scope.row.indeterminate" @change="treeNodeChange(scope.row)" v-show="~~scope.row.type==0"></el-checkbox>
                </template>
              </el-editable-column> -->
              <!-- <el-editable-column prop="name" label="æ„ä»¶åç§°" :edit-render="{name: 'ElInput'}"></el-editable-column>
              <el-editable-column prop="m1" label="æ··å‡åœŸç Œå—(mÂ³)" :edit-render="{name: 'ElInputNumber'}"></el-editable-column>
              <el-editable-column prop="m2" label="æ¨¡æ¿é¢ç§¯ï¼ˆã¡ï¼‰" :edit-render="{name: 'ElInputNumber'}"></el-editable-column> -->
              <el-editable-column v-for="(item, idx) in columnList" :key="idx" :prop="item" :label="item"></el-editable-column>
              <!-- <el-editable-column width="50">
                <template slot-scope="scope"> -->
              <!-- hasActiveRow åˆ¤æ–­å½“å‰æ˜¯å¦æ´»åŠ¨è¡Œ -->
              <!-- <template v-if="$refs.editable.hasActiveRow(scope.row)">
                    <i class="el-icon-check" @click="saveRowEvent(scope.row,'editable')"></i>
                    <i class="el-icon-close" @click="cancelRowEvent(scope.row,'editable')"></i>
                  </template>
                  <template v-else>
                    <i class="el-icon-plus" @click="insertEvent(scope.row,'editable')" v-show="scope.row.type==1&scope.row.expandNode"></i>
                    <i class="el-icon-delete" @click="removeEvent(scope.row,'editable')" v-show="~~scope.row.type==0"></i>
                  </template>
                </template>
              </el-editable-column> -->
            </el-editable>
            <el-editable v-if="value2==1" ref="editable2" :edit-config="{trigger: 'manual', mode: 'row'}" :edit-rules="validRules2" :data.sync="list" @clear-active="clearActiveEvent" @selection-change="handleSelectionChange">
              <el-editable-column label width="45">
                <template slot-scope="scope">
                  <i :class="treeIcons(scope.row)" @click="toggleCollapseNode(scope.row)"></i>
                  <el-checkbox v-model="scope.row.isCheck" :indeterminate="scope.row.indeterminate" @change="treeNodeChange(scope.row)" v-show="scope.row.parentId"></el-checkbox>
                </template>
              </el-editable-column>
              <el-editable-column prop="projectCode" label="é¡¹ç›®ç¼–ç " :edit-render="{name: 'ElInput'}"></el-editable-column>
              <el-editable-column prop="projectName" label="é¡¹ç›®åç§°" :edit-render="{name: 'ElInput'}"></el-editable-column>
              <el-editable-column prop="workQuantity" label="å·¥ç¨‹é‡" :edit-render="{name: 'ElInputNumber'}"></el-editable-column>
              <el-editable-column width="50">
                <template slot-scope="scope">
                  <template v-if="$refs.editable2.hasActiveRow(scope.row)">
                    <i class="el-icon-check" @click="saveRowEvent(scope.row,'editable2')"></i>
                    <i class="el-icon-close" @click="cancelRowEvent(scope.row,'editable2')"></i>
                  </template>
                  <template v-else>
                    <i class="el-icon-plus" @click="insertEvent(scope.row,'editable2',1)" v-show="scope.row.type==1&scope.row.expandNode&!scope.row.parentId"></i>
                    <i class="el-icon-more-outline" @click="split(scope.row,'editable2')" v-show="scope.row.type==1&~~scope.row.parentId!=0"></i>
                    <i class="el-icon-delete" @click="removeEvent(scope.row,'editable2')" v-show="~~scope.row.type==0"></i>
                  </template>
                </template>
              </el-editable-column>
            </el-editable>
          </el-col>
          <el-col :span="14" v-show="selected">
            <el-table :data="tableData2" highlight-current-row @row-click="clickItem" :header-cell-class-name="tableheaderClassName" style="width: 100%">
              <el-table-column label width="50">
                <template slot-scope="scope">
                  <el-radio v-model="radio" :label="scope.row.id">
                    <i></i>
                  </el-radio>
                </template>
              </el-table-column>
              <el-table-column prop="name" label="ä»»åŠ¡åç§°"></el-table-column>
              <el-table-column prop="date" label="è®¡åˆ’å®Œæˆæ—¶é—´"></el-table-column>
              <el-table-column prop="duration" label="å·¥æœŸ" show-overflow-tooltip></el-table-column>
            </el-table>
          </el-col>
        </el-row>
      </el-col>
      <el-col :span="12">
        <div>
          <el-button type="primary" @click="centerDialogVisible = true" style="float:right;">
            <img src="../../../assets/icons/match.png"> æ¸…å•ä¸€é”®åŒ¹é…
          </el-button>
        </div>
        <!-- æ¨¡å‹box -->
        <div></div>
      </el-col>
    </el-row>

    <el-dialog title="å­—æ®µæ˜ å°„" :visible.sync="centerDialogVisible" width="40%" center>
      <el-row>
        <el-col :offset="5" :span="9">
          <div class="grid-content bg-purple">æ¨¡å‹</div>
        </el-col>
        <el-col :span="10">
          <div class="grid-content bg-purple-light">å·¥ç¨‹é‡æ¸…å•</div>
        </el-col>
      </el-row>
      <el-form ref="form" label-width="80px">
        <el-form-item label="æ¥¼å±‚åŒ¹é…">
          <el-select v-model="floorType.floor" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options3" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <el-select v-model="floorType.floor2" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options4" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <div @click="addFloor()" class="add_btn"></div>
        </el-form-item>
        <!-- æ–°å¢çš„æ¥¼å±‚åŒ¹é… -->
        <el-form-item label v-for="(list) in addFloorType" :key="list.index">
          <el-select v-model="list.floor" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options3" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <el-select v-model="list.floor2" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options4" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <div @click="addFloorType.splice(index, 1)" class="delete_btn"></div>
        </el-form-item>
        <el-form-item label="æ„ä»¶åŒ¹é…">
          <el-select v-model="form.artifact" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options3" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <el-select v-model="form.artifact2" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options4" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <div @click="addArtifact()" class="add_btn"></div>
        </el-form-item>
        <!-- æ–°å¢çš„æ„ä»¶åŒ¹é… -->
        <el-form-item label v-for="(list) in addArtifactType" :key="list.index">
          <el-select v-model="list.artifact" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options4" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <el-select v-model="list.artifact2" placeholder="è¯·é€‰æ‹©">
            <el-option v-for="item in options4" :key="item.value" :label="item.label" :value="item.value"></el-option>
          </el-select>
          <div @click="addArtifactType.splice(index, 1)" class="delete_btn"></div>
        </el-form-item>
      </el-form>
      <span slot="footer" class="dialog-footer">
        <el-button @click="centerDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button class="selected" @click="centerDialogVisible = false">ä¸€é”®åŒ¹é…</el-button>
      </span>
    </el-dialog>
    <el-dialog title="æ‹†åˆ†" :visible.sync="splitDialogVisible" width="40%" center class="split">
      <el-row type="flex" justify="center">
        <el-col :span="8">é¡¹ç›®ç¼–ç  : {{splitProjectCode}}</el-col>
        <el-col :span="8">é¡¹ç›®åç§° : {{splitProjectName}}</el-col>
        <el-col :span="5">å·¥ä½œé‡ : {{splitWorkQuantity}}</el-col>
      </el-row>
      <el-row type="flex" justify="center">
        <el-col :span="21">
          <el-form ref="form" label-width="59px">
            <el-form-item label="æ‹†åˆ†é¡¹ : " class="fancy">
              <el-radio-group v-model="form.resource">
                <el-radio label="æŒ‰æ¥¼å±‚æ‹†åˆ†"></el-radio>
                <el-radio label="æŒ‰æ•°é‡æ‹†åˆ†"></el-radio>
              </el-radio-group>
            </el-form-item>
            <hr>
            <el-form-item label="æ•°é‡ : " class="fancy" v-if="form.resource =='æŒ‰æ•°é‡æ‹†åˆ†'">
              <el-input v-model="form.quantity" type="number" :placeholder="splitWorkQuantity"></el-input>
            </el-form-item>
            <el-form-item :label="item.label" v-for="(item) in splitArr" :key="item.index">
              <el-input v-model="item.value" type="number" placeholder="17.41"></el-input>
            </el-form-item>
          </el-form>
        </el-col>
      </el-row>
      <span slot="footer" class="dialog-footer">
        <el-button @click="splitDialogVisible = false">å– æ¶ˆ</el-button>
        <el-button class="selected" @click="comfirmSplit">ç¡®è®¤</el-button>
      </span>
    </el-dialog>
  </div>
</template>

<script type='textecmascript-6'>
  import Vue from "vue";
  import VueElementExtends from "vue-element-extends";
  import "vue-element-extends/lib/index.css";
  Vue.use(VueElementExtends);
  import XEUtils from "xe-utils";

  import {
    GetBuilding,
    GetAllElementList,
    GetCurrentListType,
    GetBuildImportType,
    GetBOQList
  } from "@/api/api.js"

  export default {
    data () {
      return {
        splitArr: [
          { value: "", label: "-2F" },
          { value: "", label: "-1F" },
          { value: "", label: "1F" }
          // { value: "", label: "2F" },
          // { value: "", label: "3F" },
          // { value: "", label: "4F" },
          // { value: "", label: "5F" },
          // { value: "", label: "6F" },
          // { value: "", label: "7F" },
          // { value: "", label: "8F" },
          // { value: "", label: "9F" },
          // { value: "", label: "10F" }
        ], //æ‹†åˆ†ä¹‹åçš„æ•°ç»„
        valueArr: [], //å­˜å‚¨æ‹†åˆ†ä¹‹åå¤šä¸ªæ‹†åˆ†å€¼çš„æ•°ç»„ // ç‚¹å‡»æ‹†åˆ†ä¹‹åçš„è¡¨æ ¼æ•°æ®
        floorType: {
          floor: "", //æ¥¼å±‚åŒ¹é… æ¨¡å‹
          floor2: "" //æ¥¼å±‚åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        },
        artifactType: {
          artifact: "", //æ„ä»¶åŒ¹é… æ¨¡å‹
          artifact2: "" //æ„ä»¶åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        },
        addFloorType: [], // æ¥¼å±‚åŒ¹é…ï¼ˆå¢å‡éƒ¨åˆ†ï¼‰
        addArtifactType: [], // æ„ä»¶åŒ¹é…ï¼ˆå¢å‡éƒ¨åˆ†ï¼‰
        radio: "", //ä»»åŠ¡å…³è” å•é€‰
        selected: false, //æ§åˆ¶æ˜¾ç¤ºæ¸…å•å…³è”è¿˜æ˜¯ä»»åŠ¡å…³è”
        centerDialogVisible: false, //æ§åˆ¶ä¸€é”®åŒ¹é…æ¨¡æ€æ¡†æ˜¾ç¤ºä¸å¦
        splitDialogVisible: false, //æ§åˆ¶æ‹†åˆ†æ¨¡æ€æ¡†æ˜¾ç¤ºä¸å¦
        loading: false,
        currentRow: null,
        validRules: {
          //æ–°å¢è¡ŒéªŒè¯è§„åˆ™
          name: [{ required: true, message: "è¯·è¾“å…¥æ„ä»¶åç§°", trigger: "blur" }],
          m1: [{ required: true, message: "è¯·è¾“å…¥æ··å‡åœŸç Œå—", trigger: "blur" }],
          m2: [{ required: true, message: "è¯·è¾“å…¥æ¨¡æ¿é¢ç§¯", trigger: "blur" }]
        },
        validRules2: {
          //æ–°å¢è¡ŒéªŒè¯è§„åˆ™
          projectCode: [
            { required: true, message: "è¯·è¾“å…¥é¡¹ç›®ç¼–ç ", trigger: "blur" }
          ],
          projectName: [
            { required: true, message: "è¯·è¾“å…¥é¡¹ç›®åç§°", trigger: "blur" }
          ],
          workQuantity: [
            { required: true, message: "è¯·è¾“å…¥å·¥ç¨‹é‡", trigger: "blur" }
          ]
        },
        list: [],
        treeNode: [],
        treeList: [],
        data2: [{
          label: "æ•´ä½“æ¨¡å‹",
          children: []
        }],
        array: [{
          label: "æ•´ä½“æ¨¡å‹",
          children: []
        }],
        defaultProps: {
          children: "children",
          label: "label"
        },
        options: [],
        floorId: "",
        projectid: '',  // é¡¹ç›®id
        options2: [],
        value2: "",
        tableData2: [
          {
            id: 1,
            date: "2019.01.07",
            name: "1Fä¸»ä½“ç»“æ„",
            duration: "6"
          },
          {
            id: 2,
            date: "2019.01.08",
            name: "2Fä¸»ä½“ç»“æ„",
            duration: "9"
          },
          {
            id: 3,
            date: "2019.01.09",
            name: "3Fä¸»ä½“ç»“æ„",
            duration: "5"
          },
          {
            id: 4,
            date: "2019.01.10",
            name: "4Fä¸»ä½“ç»“æ„",
            duration: "6"
          },
          {
            id: 5,
            date: "2019.01.11",
            name: "5Fä¸»ä½“ç»“æ„",
            duration: "5"
          },
          {
            id: 6,
            date: "2019.01.12",
            name: "6Fä¸»ä½“ç»“æ„",
            duration: "6"
          }
        ],
        // currentRow: null, //å•é€‰
        options3: [
          {
            value: "é€‰é¡¹1",
            label: "1F"
          },
          {
            value: "é€‰é¡¹2",
            label: "2F"
          },
          {
            value: "é€‰é¡¹3",
            label: "3F"
          },
          {
            value: "é€‰é¡¹4",
            label: "4F"
          },
          {
            value: "é€‰é¡¹5",
            label: "5F"
          }
        ],
        value3: "",
        options4: [
          {
            value: "é€‰é¡¹1",
            label: "ç¬¬ä¸€å±‚"
          },
          {
            value: "é€‰é¡¹2",
            label: "ç¬¬äºŒå±‚"
          },
          {
            value: "é€‰é¡¹3",
            label: "ç¬¬ä¸‰å±‚"
          },
          {
            value: "é€‰é¡¹4",
            label: "ç¬¬å››å±‚"
          },
          {
            value: "é€‰é¡¹5",
            label: "ç¬¬äº”å±‚"
          }
        ],
        value4: "",
        form: {
          floor: "",
          artifact: "",
          floor2: "",
          artifact2: ""
        },
        treeData: {},
        splitRow: "",
        splitProjectName: "", //æ‹†åˆ†æ¨¡æ€æ¡†
        splitProjectCode: "", //æ‹†åˆ†æ¨¡æ€æ¡†
        splitWorkQuantity: "", //æ‹†åˆ†æ¨¡æ€æ¡†
        columnList: []
      };
    },
    created () {
      this.projectid = localStorage.getItem('projectid')
      this.init();
      this.GetBuilding()
      this.GetCurrentListType()
    },
    methods: {
      //ç‚¹å‡»æ‹†åˆ†ä¹‹å
      split (row, ref) {
        this.splitRow = row;
        this.splitDialogVisible = true;
        this.splitProjectName = row.projectName;
        this.splitProjectCode = row.projectCode;
        this.splitWorkQuantity = row.workQuantity;
      },
      //åœ¨æ‹†åˆ†æ¨¡æ€æ¡†å†…ç‚¹å‡»ç¡®å®šæ—¶æ ¡éªŒæ•°æ®
      comfirmSplit () {
        console.log(this.splitRow);
        for (let i = 0; i < this.splitArr.length; i++) {
          if (!this.splitArr[i].value) {
            alert("ç¬¬" + (i + 1) + "é¡¹ä¸èƒ½ä¸ºç©º");
            this.splitDialogVisible = true;
            return;
          }
        }
        this.splitArr
          .map(item => item.value) //åŠ¨æ€æ·»åŠ å±æ€§å€¼æ•°ç»„
          .map((item, index) => {
            this.valueArr.push(
              Object.assign(
                {},
                {},
                {
                  projectCode: this.splitProjectCode,
                  projectName: this.splitProjectName,
                  workQuantity: item
                }
              )
            );
          });
        console.log(this.valueArr);
        this.splitArr.map(item => (item.value = "")); //æ‹†åˆ†ä¹‹å,å†æ¬¡ç‚¹å‡»è¿›å…¥æ‹†åˆ†æ¨¡æ€æ¡†,è¡¨å•
        this.splitDialogVisible = false; //å…³é—­æ‹†åˆ†æ¨¡æ€æ¡†
        this.valueArr.map(item => {
          console.log(item);
          console.log(this.splitRow);
          this.insertEvent(this.splitRow, "editable2", 0, item);
        });
        this.valueArr = [];
        return;
      },
      // æ·»åŠ æ¥¼å±‚åŒ¹é…
      addFloor () {
        this.addFloorType.push({
          floor: "", //æ¥¼å±‚åŒ¹é… æ¨¡å‹
          floor2: "" //æ¥¼å±‚åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        });
      },
      // æ·»åŠ æ„ä»¶åŒ¹é…
      addArtifact () {
        this.addArtifactType.push({
          artifact: "", //æ¥¼å±‚åŒ¹é… æ¨¡å‹
          artifact2: "" //æ¥¼å±‚åŒ¹é… å·¥ç¨‹é‡æ¸…å•
        });
      },
      //è·å–é€‰ä¸­çš„æ ‘èŠ‚ç‚¹ç»„æˆçš„æ•°ç»„
      getCheckedKeys () {
        console.log(this.$refs.tree.getCheckedKeys(true)); //(leafOnly) æ¥æ”¶ä¸€ä¸ª boolean ç±»å‹çš„å‚æ•°ï¼Œè‹¥ä¸º true åˆ™ä»…è¿”å›è¢«é€‰ä¸­çš„å¶å­èŠ‚ç‚¹çš„ keysï¼Œé»˜è®¤å€¼ä¸º false
        this.multipleSelection = this.$refs.tree.getCheckedKeys(true);
        console.log(this.multipleSelection);
      },
      //è·å–é€‰ä¸­è¡¨æ ¼ä¸­çš„æ•°æ®ç»„æˆçš„æ•°ç»„
      handleSelectionChange (val) {
        this.multipleSelection = val.map(val => val.id);
        console.log(this.multipleSelection);
      },
      // resetChecked() {
      //   this.$refs.tree.setCheckedKeys([]);
      // }
      //ä¿®æ”¹è¡¨æ ¼è¡¨å¤´çš„èƒŒæ™¯é¢œè‰²
      tableheaderClassName () {
        return "table-head-th";
      },
      setCurrent (row) {
        this.$refs.singleTable.setCurrentRow(row);
      },
      // 	å½“æŸä¸€è¡Œè¢«ç‚¹å‡»æ—¶ä¼šè§¦å‘è¯¥äº‹ä»¶
      clickItem (row) {
        this.radio = row.id === this.radio ? "" : row.id;
      },
      // æ ‘è¡¨æ ¼çš„é€»è¾‘
      init () {
        this.findList();
      },
      findList () {
        this.loading = true;
        return this.loadList()
          .then(() => {
            this.loading = false;
          })
          .catch(() => {
            this.loading = false;
          });
      },
      //
      loadList () {
        if (this.value2 != 1) {
          return this.getDataJSON().then(data => {
            this.initTreeList(data);
            console.log(this.treeNode);
            console.log(this.treeList);
          });
        } else {
          return this.getData2JSON().then(data => {
            this.initTreeList(data);
            console.log(this.treeNode);
            console.log(this.treeList);
          });
        }
      },
      //è·å–è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
      getChildren (row) {
        return this.treeList.filter(item => item.parentId === row.id);
      },
      //
      // hasDirectory(row) {
      //   return this.getChildren(row).length > 0;
      // },
      reloedTreeList (data) {
        this.initTreeList(data, true);
      },
      // å°†ä¸€ä¸ªå¸¦å±‚çº§çš„æ•°æ®åˆ—è¡¨è½¬æˆæ ‘ç»“æ„
      initTreeList (data, isReload) {
        // toArrayTree ( array, options ) ä¸€ä¸ªé«˜æ€§èƒ½çš„æ ‘ç»“æ„è½¬æ¢å‡½æ•°ï¼Œå°†ä¸€ä¸ªå¸¦å±‚çº§çš„æ•°æ®åˆ—è¡¨è½¬æˆæ ‘ç»“æ„
        // è‡ªå®šä¹‰æ•°æ®å­˜æ”¾å±æ€§
        let treeNode = XEUtils.toArrayTree(data, {
          key: "id",
          parentKey: "parentId",
          children: "children"
        });
        // toTreeArray ( array, options ) å°†ä¸€ä¸ªæ ‘ç»“æ„è½¬æˆæ•°ç»„åˆ—è¡¨
        let treeList = XEUtils.toTreeArray(treeNode, { children: "children" });
        if (!isReload) {
          treeList.forEach(item => {
            Object.assign(item, {
              expandNode: false,
              showNode: false,
              isCheck: false,
              indeterminate: false
            });
          });
        }
        this.treeNode = treeNode; // ç›®å½•èŠ‚ç‚¹
        this.treeList = treeList; // å…¨éƒ¨èŠ‚ç‚¹
        if (!isReload) {
          treeNode.forEach((item, index) => {
            Object.assign(item, {
              treeLevel: 0,
              treeIndex: index,
              showNode: true
            });
          });
        }
        this.loadTree();
      },
      // åˆ¤æ–­è¡¨æ ¼å±•å¼€ä¸å¦çš„å›¾æ ‡æ ·å¼
      treeIcons (row) {
        let clsName =
          row.type === 1 //
            ? row.expandNode //
              ? "el-icon-caret-bottom"
              : "el-icon-caret-top"
            : "";
        return clsName;
      },
      //åˆ¤æ–­ä¸€æ¡æ•°æ®æ˜¯å¦è¢«é€‰ä¸­
      treeNodeChange (row) {
        if (row.isCheck) {
          row.indeterminate = false;
        }
        // this.treeCheckChildNode(row, row.isCheck);
        this.treeCheckParentNode(row);
      },
      // åˆ‡æ¢ å±•å¼€ç›®å½•çš„é€»è¾‘
      treeCollapseNode (parent, expand) {
        let children = this.treeList.filter(item => item.parentId === parent.id);
        parent.expandNode = !!(expand && children.length);
        children.forEach((child, index) => {
          child.treeIndex = index;
          child.treeLevel = parent.treeLevel + 1;
          child.showNode = expand !== null ? expand : false;
          this.treeCollapseNode(child, null);
        });
      },
      loadTree () {
        this.list = this.treeList.filter(item => item.showNode); // ç›®å½• list
      },
      // åˆ‡æ¢ ç›®å½•çš„æ ·å¼
      treeRowClassName ({ row }) {
        let clsName = `tree-level_${row.treeLevel}`;
        if (this.currentRow && this.currentRow.id === row.id) {
          clsName += " current-row";
        }
        return clsName;
      },
      // åˆ‡æ¢ å±•å¼€ç›®å½•
      toggleCollapseNode (row) {
        this.treeCollapseNode(row, !row.expandNode);
        this.loadTree();
      },
      rowClickEvent (row) {
        this.currentRow = row;
      },

      /**
      selectRow:æ–°å¢çš„ä¸€è¡Œæ•°æ®çš„çˆ¶çº§æ•°æ®
      file:æ–°å¢çš„ä¸€è¡Œæ•°æ®
      type:0->ç›®å½•,1->æ–‡ä»¶
      */
      insertEvent (selectRow, ref, type = 0, file) {
        console.log(file);
        if (!this.$refs[ref].checkValid().error) {
          let children = [];
          let isAppand = false;
          let index = selectRow
            ? XEUtils.findIndexOf(this.list, item => item.id === selectRow.id)
            : 0;
          let data = Object.assign(
            {
              isNew: true,
              id: Date.now(),
              type: type,
              parentId: null,
              treeLevel: 0,
              treeIndex: 0,
              expandNode: false,
              showNode: true,
              isCheck: false,
              indeterminate: false
            },
            file
          );

          if (selectRow) {
            children = this.getChildren(selectRow);
            isAppand =
              selectRow.type === 1 && (selectRow.expandNode || !children.length);
            if (isAppand) {
              selectRow.expandNode = true; //å±•å¼€
              data.parentId = selectRow.id; //è¢«é€‰ä¸­è¡Œæ•°æ®çš„idå°±æ˜¯æ’å…¥æ•°æ®çš„çˆ¶id
              data.treeLevel = selectRow.treeLevel + 1;
            } else {
              data.parentId = selectRow.parentId;
              data.treeLevel = selectRow.treeLevel;
            }
          }
          console.log(data);

          let row = this.$refs[ref].insertAt(
            data,
            isAppand ? index + children.length + 1 : index
          ); //ç¬¬äºŒä¸ªå‚æ•°å¦‚æœæ˜¯ row æˆ– $index åˆ™åœ¨æŒ‡å®šä½ç½®æ–°å¢ä¸€æ¡æ•°æ®ï¼Œå¦‚æœæ˜¯ -1 åˆ™ä»æœ€åæ–°å¢ä¸€æ¡æ•°æ®
          // console.log(row);
          // let row = this.$refs[ref].insert(data);
          this.currentRow = row;
          this.$nextTick(() => {
            if (selectRow) {
              let dataIndex = XEUtils.findIndexOf(
                this.treeList,
                item => item.id === selectRow.id
              );
              this.treeList.splice(
                isAppand ? dataIndex + children.length + 1 : dataIndex,
                0,
                row
              );
            } else {
              this.treeList.push(row);
            }
            this.reloedTreeList(this.treeList);
            if (!file) {
              this.$nextTick(() => this.$refs[ref].setActiveRow(row)); //   åªå¯¹ mode=row æœ‰æ•ˆï¼Œæ¿€æ´»æŒ‡å®šè¡Œè¡Œä¸ºå¯ç¼–è¾‘çŠ¶æ€
            }
          });
        }
      },
      // å–æ¶ˆä¿å­˜å½“å‰ç¼–è¾‘è¡Œ ğŸ™‚
      cancelRowEvent (row, ref) {
        let activeInfo = this.$refs[ref].getActiveRow(); // getActiveRow è·å–å½“å‰æ´»åŠ¨è¡Œæˆ–åˆ—çš„ä¿¡æ¯
        if (activeInfo && activeInfo.isUpdate) {
          MessageBox.confirm("è¯¥æ•°æ®æœªä¿å­˜ï¼Œæ˜¯å¦ç§»é™¤?", "æ¸©é¦¨æç¤º", {
            confirmButtonText: "ç§»é™¤æ•°æ®",
            cancelButtonText: "è¿”å›ç»§ç»­",
            type: "warning"
          })
            .then(action => {
              if (action === "confirm") {
                this.treeList = this.treeList.filter(item => item.id !== row.id); // ä»ç¼“å­˜æ ‘ä¸­ç§»é™¤
                this.reloedTreeList(this.treeList); //é‡æ–°åŠ è½½ç¼“å­˜æ ‘
              } else {
                this.$refs[ref].setActiveRow(row); //  åªå¯¹ mode=row æœ‰æ•ˆï¼Œæ¿€æ´»æŒ‡å®šè¡Œè¡Œä¸ºå¯ç¼–è¾‘çŠ¶æ€
              }
            })
            .catch(e => e)
            .then(() => {
              // this.isClearActiveFlag = true
            });
        } else {
          this.$refs[ref].clearActive();
        }
      },
      // ç§»é™¤å½“å‰è¡Œ ğŸ™‚
      removeEvent (row, ref) {
        MessageBox.confirm("ç¡®å®šåˆ é™¤è¯¥è¡Œæ•°æ®?", "æ¸©é¦¨æç¤º", {
          confirmButtonText: "ç¡®å®š",
          cancelButtonText: "å–æ¶ˆ",
          type: "warning"
        })
          .then(() => {
            // this.$refs[ref].remove(row); // é¦–å…ˆåœ¨ ref ä¸­åˆ é™¤ row
            this.treeList = this.treeList.filter(item => item.id !== row.id); // ç„¶åä¸€å®šè¦åœ¨ this.treeList ä¸­åˆ é™¤ row  // è§£å†³æ— æ³•æˆåŠŸåˆ é™¤æ•°æ®
            // this.updateRowEvent(row);
            this.reloedTreeList(this.treeList); //é‡æ–°åŠ è½½ç¼“å­˜æ ‘
          })
          .catch(e => e);
      },
      clearActiveEvent (row) {
        this.updateRowEvent(row);
      },
      //æ›´æ–°æ ‘è¡¨æ ¼æ•°æ®
      updateRowEvent (row) {
        // this.$refs[ref].reloadRow(row); // reloadRow() åˆå§‹åŒ–æŒ‡å®šè¡Œæ•°æ®
        Message({ message: "ä¿å­˜æˆåŠŸ", type: "success" });
      },
      //ä¿å­˜å½“å‰ç¼–è¾‘è¡Œ
      saveRowEvent (row, ref) {
        console.log(row);
        this.$refs[ref].validateRow(row, valid => {
          if (valid) {
            this.$refs[ref].clearActive(); //æ¸…é™¤æ‰€æœ‰æ´»åŠ¨è¡Œæˆ–åˆ—ä¸ºä¸å¯ç¼–è¾‘çŠ¶æ€
            this.$refs[ref].reloadRow(row); //åˆå§‹åŒ–æŒ‡å®šè¡Œæ•°æ®
            Message({ message: "ä¿å­˜æˆåŠŸ", type: "success" });
          } else {
            this.$refs[ref].revert(row); // æ”¾å¼ƒæ›´æ”¹ï¼Œè¿˜åŸæŒ‡å®šè¡Œ row æˆ–è€…æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®
          }
        });
      },
      // æ¨¡æ‹Ÿæ•°æ®
      getDataJSON () {
        return new Promise(resolve => {
          setTimeout(
            () =>
              resolve([
                {
                  id: 1,
                  name: "åŸºç¡€å¢™1",
                  type: 1,
                  parentId: null
                },
                {
                  id: 11,
                  name: "ç Œä½“å¢™-11",
                  type: 0,
                  parentId: 1,
                  m1: "69.65",
                  m2: "69.65"
                },
                {
                  id: 12,
                  name: "ç Œä½“å¢™-12",
                  type: 0,
                  parentId: 1,
                  m1: "69.95",
                  m2: "69.65"
                },
                {
                  id: 2,
                  name: "åŸºç¡€å¢™2",
                  type: 1,
                  parentId: null
                },
                {
                  id: 21,
                  name: "ç Œä½“å¢™-21",
                  type: 0,
                  parentId: 2,
                  m1: "69.65",
                  m2: "69.65"
                },
                {
                  id: 22,
                  name: "ç Œä½“å¢™-22",
                  type: 0,
                  parentId: 2,
                  m1: "69.95",
                  m2: "69.65"
                },
                {
                  id: 23,
                  name: "ç Œä½“å¢™-23",
                  type: 0,
                  parentId: 2,
                  m1: "69.95",
                  m2: "69.65"
                },
                {
                  id: 24,
                  name: "ç Œä½“å¢™-24",
                  parentId: 2,
                  type: 0,
                  m1: "69.95",
                  m2: "69.65"
                },
                {
                  id: 25,
                  name: "ç Œä½“å¢™-25",
                  parentId: 2,
                  type: 0,
                  m1: "69.95",
                  m2: "69.65"
                },
                {
                  id: 26,
                  name: "ç Œä½“å¢™-26",
                  parentId: 2,
                  type: 0,
                  m1: "69.95",
                  m2: "69.65"
                }
              ]),
            350
          );
        });
      },
      getData2JSON () {
        return new Promise(resolve => {
          setTimeout(
            () =>
              resolve([
                {
                  id: 1,
                  projectCode: "ç Œä½“éƒ¨åˆ†",
                  type: 1,
                  parentId: null
                },
                {
                  id: 11,
                  projectCode: "11111111111-11",
                  type: 1,
                  parentId: 1,
                  projectName: "å¤šå­”ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 12,
                  projectCode: "11111111111-2",
                  type: 1,
                  parentId: 1,
                  projectName: "ç Œå—ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 13,
                  projectCode: "11111111111-3",
                  type: 1,
                  parentId: 1,
                  projectName: "ç Œå—ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 2,
                  projectCode: "22222222222",
                  type: 1,
                  parentId: null
                },
                {
                  id: 21,
                  projectCode: "22222222222-1",
                  type: 1,
                  parentId: 2,
                  projectName: "ç Œå—ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 22,
                  projectCode: "22222222222-2",
                  type: 1,
                  parentId: 2,
                  projectName: "ç Œå—ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 23,
                  projectCode: "22222222222-3",
                  type: 1,
                  parentId: 2,
                  projectName: "ç Œå—ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 24,
                  projectCode: "22222222222-4",
                  parentId: 2,
                  type: 1,
                  projectName: "ç Œå—ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 25,
                  projectCode: "22222222222-5",
                  parentId: 2,
                  type: 1,
                  projectName: "ç Œå—ç –",
                  workQuantity: "69.65"
                },
                {
                  id: 26,
                  projectCode: "22222222222-6",
                  parentId: 2,
                  type: 1,
                  projectName: "69.95",
                  workQuantity: "69.65"
                }
              ]),
            350
          );
        });
      },
      /** 
       * è·å–æ¸…å•ç±»å‹ 
       * @returns 0ä¸ºæœªå¯¼å…¥ 1ä¸ºæ–½å·¥å›¾æ¸…å• 2.å…¨è´¹ç”¨æ¸…å• 3.æ„ä»¶ç”Ÿæˆæ¸…å•
       * */
      GetCurrentListType () {
        GetCurrentListType().then(data => {
          this.GetBuildImportType()
          // if (data.Detiel === 1) {
          //   this.GetBuildImportType()
          // }
          // æ— æ¸…å•
        })
      },
      /**
       * è·å–æ¥¼æ ‹ä¿¡æ¯
       * @param {String} projectid é¡¹ç›®id
       */
      GetBuilding () {
        GetBuilding({ projectid: this.projectid }).then(data => {
          data.Detiel.forEach(item => {
            this.data2[0].children.push({
              id: item.id,
              label: item.text,
              children: []
            })
          })
          this.options = data.Detiel
          this.options.unshift({ id: '', text: 'å…¨éƒ¨' })
          this.array = JSON.parse(JSON.stringify(this.data2))
        })
      },
      /** 
       * è·å–æ¨¡å‹æ„ä»¶æ¸…å•æ•°æ® 
       * @param {String} projectid é¡¹ç›®id
       * @param {String} floor æ¥¼å±‚id
       * */
      GetAllElementList () {
        let param = {
          projectid: this.projectid,
          floor: this.floorId
        }
        GetAllElementList(param).then(data => {
          if (this.floorId === '') {
            this.array = JSON.parse(JSON.stringify(this.data2))
            return
          }
          this.array[0].children = []
          this.data2[0].children.forEach((item, idx) => {
            if (item.id === this.floorId) {
              this.array[0].children.push({
                id: item.id,
                label: item.label,
                children: []
              })
            }
          })
        })
      },
      /**
       * è·å–æ–½å·¥å›¾æ¸…å•å¯¼å…¥ä¸­æ¥¼æ ‹å’Œå¯¼å…¥ç±»å‹ï¼ˆæ–½å·¥å›¾ä¸‹æ‹‰åˆ—è¡¨ï¼‰
       * @param {String} projectid é¡¹ç›®id
       */
      GetBuildImportType () {
        GetBuildImportType({ projectid: this.projectid }).then(data => {
          this.options2 = data.Detiel
        })
      },
      /**
       * è·å–é¢„ç®—æ¸…å•æ•°æ®
       * @param {String} projectid é¡¹ç›®ID
       * @param {String} type å¯¼å…¥ç±»å‹
       */
      GetBOQList () {
        let param = {
          pageIndex: 1,
          pageSize: 9999,
          buildname: '',
          floor: '',
          elementname: '',
          projectid: this.projectid,
          type: this.value2
        }
        GetBOQList(param).then(data => {
          this.tableData = data.Result
          let list = Object.keys(data.Result[0])
          this.columnList = list.filter(item => item !== 'åºå·' && item !== 'æ¥¼å±‚' && item !== 'RowId')
        })
      }
    }
    // watch: {
    //   value2: function (val) {
    //     this.loadList();
    //   }
    // }
  };
</script>

<style>
  .container-artifacts-associated * {
    font-size: 28px; /*px*/
  }
  .container-artifacts-associated
    .el-col-14
    .el-select
    .el-input
    .el-select__caret {
    color: #fff;
  }
  .container-artifacts-associated .el-col-14 .el-input__inner::placeholder {
    color: #fff;
  }

  .container-artifacts-associated
    .el-row:nth-child(2)
    .el-col:nth-child(2)
    .el-input--suffix
    .el-input__inner {
    background: #435089;
    color: #fff;
  }

  .container-artifacts-associated .el-table .table-head-th {
    background-color: #435089;
    color: white;
  }
  /* select ä¸‹æ‹‰æŒ‰æŒ‰é’® */
  .container-artifacts-associated .el-dialog .el-select {
    flex: 1;
    height: 40px;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0px 3px 7px 0px rgba(229, 229, 229, 1);
    border-radius: 4px;
  }
  .container-artifacts-associated .el-dialog .el-input--suffix .el-input__inner {
    border: none;
  }
  .container-artifacts-associated .el-dialog .el-input__suffix {
    background: rgba(67, 80, 137, 1);
    border-radius: 0px 4px 4px 0px;
    right: 0;
    width: 40px;
  }
  .container-artifacts-associated .el-dialog .el-icon-arrow-up:before {
    /* content: "\e60b"; */
    content: "\e60c";
    /* font-size: 20px; */
    color: rgba(255, 255, 255, 1);
  }
  .container-artifacts-associated .el-dialog .center-select {
    margin: 0 20px;
  }
  .container-artifacts-associated
    .input-number
    .el-input-group--append
    .el-input__inner,
  .container-artifacts-associated .el-input-group__prepend {
    height: 40px;
    background: rgba(248, 248, 248, 1);
    border-radius: 4px;
    border: 1px solid rgba(229, 229, 229, 1);
    border-right: 1px dashed #979797;
  }
  .container-artifacts-associated .editable-required-icon,
  .container-artifacts-associated .el-icon-edit-outline {
    display: none;
  }
  tbody .el-table__row:nth-child(1) {
    background: #f4f6ff;
  }
  .split .fancy {
    display: block;
  }
  .split .el-form-item:not(.fancy) {
    display: inline-block;
  }
  .split .el-input {
    width: 110px;
  }
  .container-artifacts-associated .el-dialog__header {
    background: linear-gradient(
      225deg,
      rgba(105, 86, 255, 1) 0%,
      rgba(84, 138, 255, 1) 100%
    );
  }
  .container-artifacts-associated .el-dialog__title {
    color: #fff;
  }
  .container-artifacts-associated .el-radio__input.is-checked .el-radio__inner {
    border-color: #fca141;
    background: #fca141;
  }

  .container-artifacts-associated .el-radio__input.is-checked + .el-radio__label {
    color: #fca141;
  }

  .container-artifacts-associated
    .el-checkbox__input.is-checked
    .el-checkbox__inner,
  .container-artifacts-associated
    .el-checkbox__input.is-indeterminate
    .el-checkbox__inner {
    background-color: #fca141;
    border-color: #fca141;
  }
</style>

<style lang='stylus' scoped rel='stylesheet/stylus'>
  * {
    font-size: 18px;
  }

  .container-artifacts-associated {
    // width: 100%;
    height: 100%;
    padding: 0 20px;
  }

  .container-artifacts-associated .el-row {
    margin: 20px 0;
  }

  .container-artifacts-associated .el-row:nth-child(2) .el-col:nth-child(1), .container-artifacts-associated .el-row:nth-child(2) .el-col:nth-child(2) {
    height: 100%;
    background: rgba(255, 255, 255, 1);
  }

  .container-artifacts-associated .el-row:nth-child(2) .el-col header {
    width: 100%;
    background: #435089;
    color: white;
    text-align: center;
    padding: 0.1rem 0;
  }

  .container-artifacts-associated .el-row:nth-child(2) .el-col .el-select {
    width: 100%;
    height: 50px;
    color: white;
    text-align: center;
  }

  .selected {
    background: #4775CA;
    color: white;
  }

  .el-form-item div {
    margin: 0.1rem 0.6rem;
  }

  .add_btn, .delete_btn {
    background: url('../../../assets/icons/add.png') center 60% no-repeat;
    width: 0.5rem;
    height: 0.5rem;
    display: inline-block;
    float: right;
  }

  .delete_btn {
    background: url('../../../assets/icons/reduce.png') center 60% no-repeat;
  }

  .container-artifacts-associated .el-dialog__head {
    background: linear-gradient(
      225deg,
      rgba(105, 86, 255, 1) 0%,
      rgba(84, 138, 255, 1) 100%
    );
    color: white;
    /* height: 40px; */
  }
</style>